{"id": "09303b44-491a-456a-a725-11d622114924", "text": "Q: Problems when updating a list A: <p>Here is the solution:</p>\n<p>Instead of</p>\n<pre class=\"lang-py prettyprint-override\"><code>        lista.extend(registronom)\n</code></pre>\n<p>you have to write</p>\n<pre class=\"lang-py prettyprint-override\"><code>        lista.extend([registronom])\n</code></pre>\n<p>Do I have to explain why?\nHere is the hint: <code>extend</code> adds list elements to another list: <a href=\"https://www.w3schools.com/python/ref_list_extend.asp\" rel=\"nofollow noreferrer\">https://www.w3schools.com/python/ref_list_extend.asp</a>.</p>\n", "tags": ["python", "list", "input", "collections", "data-analysis"]}
{"id": "a880c2d0-5e98-4060-b9cb-b6104d06437b", "text": "Q: How to get sane definition of uint32_t when using newlib? A: <p>C standard does not specify which standard integer type <code>uint32_t</code> should alias to, or if it should alias to any standard type at all. Your assumption that <code>uint32_t</code> should be <code>unsigned int</code> is just that - an assumption. It holds true for gcc/glibc combo; it doesn't for gcc/newlib combo because newlib maps <code>uint32_t</code> to <code>__UINT32_TYPE__</code> which is defined in gcc to be <code>unsigned long</code> for 32-bit newlib targets. You'd need to patch gcc or newlib to make it into <code>int</code>.</p>\n<p>This is a very common mistake to make (e.g. I very recently saw llvm build issue because of their usage of <code>std::max</code> on <code>int32_t</code> and <code>int</code> arguments) but mistake nonetheless. Can't assume <code>uint32_t</code> is <code>unsigned int</code>, can't assume it can be losslessly converted to <code>unsigned int</code> (after all, int <em>can</em> be 16 bit), gotta use correct format specifiers. Like said in the comment, <code>PRIx32</code> macro is the only correct specifier for <code>uint32_t</code>. Alternatively one could do an explicit conversion to unsigned long, and print that converted value instead.</p>\n", "tags": ["newlib"]}
{"id": "6f2826ee-899c-4f05-9c1d-e704133cf841", "text": "Q: Valid regular expression pattern validation in XML A: <p>You say:</p>\n<blockquote>\n<p>I would like to restrict to the extended Latin character set plus numbers, punctuation, whitespace, <strong>etc</strong></p>\n</blockquote>\n<p>and:</p>\n<blockquote>\n<p>Perhaps only certain characters are supported \u2014 <strong>I can't seem to find a\nlist</strong></p>\n</blockquote>\n<p>(Emphases mine.)</p>\n<p>When I follow your regex101 link, I see you tested using the PCRE2 regex flavour. However, this is not the regular expression flavour used in XML schema. The flavour you require is defined in <a href=\"https://www.w3.org/TR/xmlschema-2/#regexs\" rel=\"nofollow noreferrer\">Appendix F</a> of the W3C Standard (aka &quot;Recommendation&quot;) &quot;<a href=\"https://www.w3.org/TR/xmlschema-2/\" rel=\"nofollow noreferrer\">XML Schema Part 2: Datatypes Second Edition</a>&quot;.</p>\n<p><a href=\"https://www.w3.org/TR/xmlschema-2/#charcter-classes\" rel=\"nofollow noreferrer\">Appendix F.1</a> of that document provides the rules needed to generate the complete list of character classes that you asked for. I won't replicate it here as it is ten pages long and links out to the Unicode standard. Also I don't know what your &quot;etc&quot; refers to. However some potentially relevant classes you could specify inside your character range (<code>[</code>..<code>]</code>) include:</p>\n<ul>\n<li><code>\\p{IsBasicLatin}</code></li>\n<li><code>\\[{IsLatin-1Supplement}</code></li>\n<li><code>\\p{IsLatinExtended-A}</code></li>\n<li><code>\\p{IsLatinExtended-B}</code></li>\n<li><code>\\p{N}</code></li>\n<li><code>\\p{P}</code></li>\n<li><code>\\p{Zs}</code></li>\n</ul>\n", "tags": ["regex", "xml", "xsd"]}
{"id": "231fb29a-347e-432e-a258-e9f5daf1442f", "text": "Q: sbcl: converting (unsigned-byte 32) into single-float A: <p>The <a href=\"https://ieee-floats.common-lisp.dev/\" rel=\"nofollow noreferrer\"><code>ieee-floats</code></a> library (Available via quicklisp) provides portable conversion between <code>(unsigned-byte 32)</code> values and IEEE-754 single floats, and <code>(unsigned-byte 64)</code> and double.</p>\n<p>Example usage:</p>\n<pre><code>(let ((pi-as-uint32 (ieee-floats:encode-float32 (float pi 1.0f0))))\n  (check-type pi-as-uint32 (unsigned-byte 32))\n  (format t &quot;~A is ~A~%&quot;\n          pi-as-uint32 (ieee-floats:decode-float32 pi-as-uint32)))\n;;; prints 1078530011 is 3.1415927\n</code></pre>\n<p>(Just be aware of how it handles values like infinity and NaN by returning keyword symbols not floats)</p>\n", "tags": ["common-lisp", "sbcl"]}
{"id": "337eb46b-56a7-402d-8dc1-ba279f4d1039", "text": "Q: How to set different icons for list bullets in QTextEdit HTML? A: <h2>Introduction: QtWidgets rich text limitations</h2>\n<p>The first thing to understand is that the HTML capabilities of the QtWidgets module must <strong>not</strong> be considered as those of a full featured web browser engine.</p>\n<p>The structure is stored in a QTextDocument with limited rich text capabilities (similar to those of the old WordPad on Windows, or as possible with pre-2000 web browsers).<br />\nThe HTML used with <code>setHtml()</code> functions is simply parsed and converted in the QTextDocument structure and the HTML node structure is never preserved after that process is completed. In fact, the output of <code>toHtml()</code> is almost never the same of what used with <code>setHtml()</code>.</p>\n<p>The QTextDocument API only supports a <a href=\"https://doc.qt.io/qt-6/richtext-html-subset.html\" rel=\"nofollow noreferrer\">limited HTML subset</a> with <em>some</em> basic CSS 2.1 capabilities, therefore doesn't allow more advanced/dynamic features introduced in HTML5 or CSS3 (and, for obvious reasons, no javascript as well). This clearly includes the customization of &quot;bullet&quot; points in lists.</p>\n<p>If you need to display a fully compliant HTML/CSS page as it would be shown in a modern web browser, the only way to do so is by using the QtWebEngine module, which features a full web engine based on the Chromium project.<br />\nKeep in mind, though, that this comes with a cost: the module alone is about 180MB, and using it obviously increases memory footprint and CPU usage.</p>\n<h2>Possible workaround: custom lists and painting</h2>\n<p>Yet, QTextDocument, in its &quot;relatively simple&quot; complexity, allows further customization, and displaying a custom text list in QTextEdit is possible.</p>\n<p>In a <a href=\"https://doc.qt.io/qt-6/richtext-structure.html\" rel=\"nofollow noreferrer\">QTextDocument structure</a>, lists use the <a href=\"https://doc.qt.io/qt-6/qtextlist.html\" rel=\"nofollow noreferrer\">QTextList</a> and the <a href=\"https://doc.qt.io/qt-6/qtextlistformat.html\" rel=\"nofollow noreferrer\">QTextListFormat</a> objects to contain list elements (blocks) and their format options.</p>\n<p>The QTextListFormat allows to define the <a href=\"https://doc.qt.io/qt-6/qtextlistformat.html#Style-enum\" rel=\"nofollow noreferrer\">style</a> of the symbols used to decorate each item, and Qt provides default styles using negative numbers. Any number equal or greater than 0 will show no symbol at all, and a 0 value is automatically set when using CSS with the <code>list-style: none;</code> property (undocumented in the above docs).</p>\n<p>The HTML support also allows setting a custom &quot;block user data&quot; for every paragraph (including list elements), meaning that we can use CSS to specify an unique number as an identifier for specific lists or even specific elements.</p>\n<p>What remains to do is the actual painting, which can be achieved by overriding the <code>paintEvent()</code> of a QTextEdit subclass. Note that this means that <em>printing</em> the document will not display custom symbols, which would require further implementation.</p>\n<h2>A simple example</h2>\n<p>The following example uses a custom class used to store the &quot;list options&quot;, a QTextEdit subclass that is able to use those objects, and a specially defined HTML with specific CSS aspects.</p>\n<p>The procedure is then:</p>\n<ol>\n<li>create an instance of the <code>CustomListData</code> with the defined symbols for every entry;</li>\n<li>set that object for a specific &quot;block user state&quot; in the custom text edit;</li>\n<li>paint the default contents, then:\n<ol>\n<li>iterate through all text blocks in the document, looking for text lists;</li>\n<li>check if the current block has a user state that matches an entry set before, and eventually keep that for later painting;</li>\n<li>iterate through all text lists found before and related data;</li>\n<li>paint every symbol of each item based on the data;</li>\n</ol>\n</li>\n</ol>\n<p>The code:</p>\n<pre class=\"lang-py prettyprint-override\"><code>from PySide6.QtCore import *\nfrom PySide6.QtGui import *\nfrom PySide6.QtWidgets import *\n\nclass CustomListData(object):\n    def __init__(self, elements=None, margin=None):\n        if isinstance(elements, dict):\n            self.elements = elements.copy()\n        elif isinstance(elements, (tuple, list)):\n            self.elements = {i:e for i, e in enumerate(elements)}\n        else:\n            self.elements = {}\n        self.margin = margin\n\n\nclass CustomListTextEdit(QTextEdit):\n    def __init__(self, *args, **kwargs):\n        super().__init__(*args, **kwargs)\n        self._customListData = {}\n\n    def addCustomListData(self, blockState, data):\n        if isinstance(data, dict):\n            data = CustomListData(data)\n        self._customListData[blockState] = data\n        self.viewport().update()\n\n    def paintEvent(self, event):\n        super().paintEvent(event)\n\n        customLists = {}\n        standardLists = []\n        doc = self.document()\n        block = doc.begin()\n\n        # Iterate through all document blocks and look for text lists. \n        # Note that all blocks should be checked, because they can be part \n        # of nested lists, so we cannot try to speed up the iteration by \n        # skipping to the last item of the list.\n        while block.isValid():\n            if block.isVisible():\n                tl = block.textList()\n                if (\n                    tl \n                    and tl not in standardLists\n                    and tl not in customLists\n                ):\n                    state = block.userState()\n                    if state in self._customListData:\n                        customLists[tl] = self._customListData[state]\n                    else:\n                        standardLists.append(tl)\n            block = block.next()\n\n        if customLists:\n            textCursor = QTextCursor(doc)\n            docMargin = doc.documentMargin()\n            indentWidth = doc.indentWidth()\n            layout = doc.documentLayout()\n            itemAlign = Qt.Alignment.AlignTop | Qt.Alignment.AlignRight\n\n            qp = QPainter(self.viewport())\n            offset = QPoint(\n                -self.horizontalScrollBar().value(), \n                -self.verticalScrollBar().value()\n            )\n\n            qp.translate(offset)\n            viewRect = QRectF(self.viewport().rect().translated(-offset))\n            bottom = viewRect.bottom()\n\n            for tl, data in customLists.items():\n                # The indent computation here is very simple, in reality we \n                # should account for margins, alignment and text direction.\n                indent = tl.format().indent() * indentWidth + docMargin\n                margin = data.margin\n                count = tl.count()\n                elements = data.elements\n\n                if None in elements:\n                    default = elements[None]\n                else:\n                    # A fallback character for undefined item indexes. Note \n                    # that the default disc/circle/square symbols used by \n                    # QTextDocument are actually drawn with the drawEllipse() \n                    # and drawRect() functions of QPainter, based on the text \n                    # layout of the list item (usually, the metrics of the \n                    # font of the first character). Here we just use the UTF \n                    # circle character for simplicity.\n                    default = '\u26ab'\n\n                for i in range(count):\n                    block = tl.item(i)\n                    blockRect = layout.blockBoundingRect(block)\n                    if not viewRect.intersects(blockRect):\n                        if blockRect.y() &gt; bottom:\n                            # Item beyond the bottom of the viewport, there \n                            # is no need to go further with this list.\n                            break\n                        # Item contents not visible, let's check other items.\n                        continue\n\n                    if i in elements:\n                        symbol = elements[i]\n                    else:\n                        # Consider negative indexes (eg: last item is -1).\n                        neg = i - count\n                        if neg in elements:\n                            symbol = elements[neg]\n                        else:\n                            symbol = default\n\n                    if symbol is None:\n                        continue\n\n                    textCursor.setPosition(block.position())\n                    font = textCursor.charFormat().font()\n\n                    if margin is None:\n                        adjust = QFontMetrics(font).horizontalAdvance('x') / 2\n                    else:\n                        adjust = margin\n\n                    r = QRectF(\n                        blockRect.x() - adjust, blockRect.y(), \n                        indent - adjust, blockRect.height()\n                    )\n\n                    if isinstance(symbol, str) and symbol:\n                        qp.setFont(font)\n                        qp.drawText(r, itemAlign, symbol)\n\n                    elif isinstance(symbol, QPixmap) and not symbol.isNull():\n                        pmRect = symbol.rect()\n                        pmRect.moveTopRight(r.toRect().topRight())\n                        qp.drawPixmap(pmRect, symbol)\n\n\nif __name__ == '__main__':\n    import sys\n\n    app = QApplication(sys.argv)\n\n    editor = CustomListTextEdit()\n\n    # Create two similar lists, having different symbols.\n    # The first custom list just shows specific symbols for the first two \n    # items and sets an explicit margin:\n    editor.addCustomListData(0, CustomListData({0: '\u2295', 1: '\u25b6'}, 6))\n\n    # The other list sets a default character symbol for all items, but \n    # different symbols (with pixmaps) just for the last two items of a list:\n    elements = {None: '\u00bb'}\n    sz = editor.fontMetrics().height()\n    gc = sz / 3\n    grad = QRadialGradient(gc, gc, gc)\n    for i, c in ((-2, Qt.GlobalColor.darkGreen), (-1, Qt.GlobalColor.red)):\n        pm = QPixmap(sz, sz)\n        pm.fill(Qt.transparent)\n        grad.setStops(((0, Qt.GlobalColor.white), (1, c)))\n        qp = QPainter(pm)\n        qp.setRenderHint(qp.RenderHint.Antialiasing)\n        qp.setPen(Qt.PenStyle.NoPen)\n        qp.setBrush(QBrush(grad))\n        qp.drawEllipse(pm.rect().adjusted(1, 1, -1, -1))\n        qp.end()\n        elements[i] = pm\n    editor.addCustomListData(1, elements)\n\n    editor.setHtml('''\n        &lt;head&gt;&lt;style&gt;\n        ul.list1, ul.list2 {\n            list-style: none;\n        }\n        ul.list1 li {\n            -qt-user-state: 0;\n        }\n        ul.list2 li {\n            -qt-user-state: 1;\n        }\n        &lt;/style&gt;&lt;/head&gt;\n\n        &lt;body&gt;\n            &lt;table width=&quot;100%&quot; border=1 cellpadding=2&gt;\n                &lt;tr&gt;\n                    &lt;td width=&quot;33.3%&quot;&gt;\n                        Default list:\n                        &lt;ul&gt;\n                            &lt;li&gt;first&lt;/li&gt;\n                            &lt;li&gt;second&lt;/li&gt;\n                            &lt;li&gt;third&lt;/li&gt;\n                            &lt;li&gt;fourth&lt;/li&gt;\n                            &lt;li&gt;last&lt;/li&gt;\n                        &lt;/ul&gt;\n                    &lt;/td&gt;\n                    &lt;td width=&quot;33.3%&quot;&gt;\n                        A custom list:\n                        &lt;ul class=&quot;list1&quot;&gt;\n                            &lt;li&gt;first&lt;/li&gt;\n                            &lt;li&gt;second&lt;/li&gt;\n                            &lt;li&gt;third&lt;/li&gt;\n                            &lt;li&gt;fourth&lt;/li&gt;\n                            &lt;li&gt;last&lt;/li&gt;\n                        &lt;/ul&gt;\n                    &lt;/td&gt;\n                    &lt;td width=&quot;33.3%&quot;&gt;\n                        Another custom list:\n                        &lt;ul class=&quot;list2&quot;&gt;\n                            &lt;li&gt;first&lt;/li&gt;\n                            &lt;li&gt;second&lt;/li&gt;\n                            &lt;li&gt;third&lt;/li&gt;\n                            &lt;li&gt;fourth&lt;/li&gt;\n                            &lt;li&gt;last&lt;/li&gt;\n                        &lt;/ul&gt;\n                    &lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/table&gt;\n        &lt;/body&gt;\n    ''')\n\n    editor.resize(500, 300)\n    editor.show()\n\n    sys.exit(app.exec())\n</code></pre>\n<p>And here is the result:</p>\n<p><a href=\"https://i.sstatic.net/eQRagqvI.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/eQRagqvI.png\" alt=\"screenshot of the code above\" /></a></p>\n<p>The above is a relatively simple implementation, which can be further improved by adding other features (QIcons with different sizes, image scaling based on the font, etc.) and some level of caching to prevent lags in the <code>paintEvent()</code> handler when displaying large documents.<br />\nAs also explained in the code comments, some advanced aspects are not considered here, most importantly the possibility of right-to-left writing systems (which may show the symbols on the right side), but it should work fine for basic and common usage.</p>\n", "tags": ["html", "css", "pyside6"]}
{"id": "d2525b4c-1e1a-4e34-a5e5-e5994cc4db64", "text": "Q: Angular Reactive Form Field - Select Multiple - patchValue doesn&#39;t work A: <p>2 scenario for your question:</p>\n<p><strong>Scenario 1: Patch array of id(s) to <code>&lt;mat-select&gt;</code></strong></p>\n<p>Conditions:</p>\n<ol>\n<li>You are patching the array of ids.</li>\n<li>The value of <code>&lt;mat-option&gt;</code> is a string which is the <code>_id</code>.</li>\n</ol>\n<pre><code>&lt;mat-select matInput \n  formControlName='managers' \n  multiple \n  [compareWith]=&quot;compareSelectOptions&quot;&gt;\n  @for(x of empNames; track x._id){\n    &lt;mat-option [value]='x._id'&gt;\n      {{ x.fullName }}\n    &lt;/mat-option&gt;\n  } \n&lt;/mat-select&gt;\n</code></pre>\n<p>In your <code>compareSelectOptions</code>, you shouldn't compare the optionsby accessing the <code>_id</code> as they are not the object, instead they are string values. Either modify the <code>compareSelectOptions</code> method as below or remove the <code>[compareWith]=&quot;compareSelectOptions&quot;</code> attribute from the <code>&lt;mat-select&gt;</code> element (for using the default comparer).</p>\n<pre><code>compareSelectOptions(option1:any, option2:any) {\n  return option1 === option2;\n}\n</code></pre>\n<p><a href=\"https://stackblitz.com/edit/mzvj5gcr-xdfgi4pg?file=src%2Fexample%2Fselect-initial-value-example.ts\" rel=\"nofollow noreferrer\">Demo Scenario 1 @ StackBlitz</a></p>\n<hr />\n<p><strong>Scenario 2: Patch array of object(s) to <code>&lt;mat-select&gt;</code></strong></p>\n<p>Conditions:</p>\n<ol>\n<li>You are patching the array of objects.</li>\n<li>The value of <code>&lt;mat-option&gt;</code> is an object.</li>\n</ol>\n<pre><code>&lt;mat-select matInput \n  formControlName=&quot;managers&quot;\n  multiple\n  [compareWith]=&quot;compareSelectOptions&quot;\n&gt;\n  @for (x of empNames; track x._id) {\n    &lt;mat-option [value]=&quot;x&quot;&gt;{{ x.fullName }}&lt;/mat-option&gt;\n  }\n&lt;/mat-select&gt;\n</code></pre>\n<p>With the above HTML, the <code>compareSelectOptions</code> function will work correctly as it compares the values by accessing from the objects.</p>\n<p><a href=\"https://stackblitz.com/edit/mzvj5gcr?file=src%2Fexample%2Fselect-initial-value-example.ts\" rel=\"nofollow noreferrer\">Demo Scenario 2 @ StackBlitz</a></p>\n", "tags": ["angular", "angular-reactive-forms", "patchvalue"]}
{"id": "851abc65-8b26-4a0b-81de-84296cf4ac0e", "text": "Q: Find key, value pair within a Python dict A: <p>If you want to check that a key contains a <em>specific</em> value (as it seems) then you need to 1) check to make sure the key is in the dictionary and if so, 2) check to make sure that the key's value is what you expect it to be. These must be done in that order since the second test will throw an error if the first step doesn't hold.</p>\n<pre><code>k = &quot;Top&quot;\nv = &quot;/Project3/Start&quot;\n\nif k in entriesTLookup:\n    if v in entriesTLookup[k]:\n        print(&quot;found&quot;)\n    else:\n        print(&quot;not found&quot;)\nelse:\n    print(&quot;not found&quot;)\n</code></pre>\n<p>Now this is a bit inelegant because there are two ways for these tests to fail, and we have to handle both of them (hence the two &quot;not found&quot; <code>print</code> calls). Fortunately we can combine them into one.</p>\n<p>Because <code>and</code> short-circuits in Python (that is, the right half of the expression is never evaluated if the left half is <code>False</code>, because if the left half is <code>False</code> then the whole expression is <code>False</code> regardless of what the right half is) you can do this in one <code>if</code>. If either condition is <code>False</code> then the whole thing is <code>False</code> and flow moves to the <code>else</code> clause.</p>\n<pre><code>k = &quot;Top&quot;\nv = &quot;/Project3/Start&quot;\n\nif k in entriesTLookup and v in entriesTLookup[k]:\n    print(&quot;found&quot;)\nelse:\n    print(&quot;not found&quot;)\n</code></pre>\n", "tags": ["python"]}
{"id": "4a0d731b-b750-48b9-8316-aa9e77960604", "text": "Q: Qt mouseMoveEvent does not work with QColumnView A: <h1>How and why <code>mouseMoveEvent()</code> works (or not)</h1>\n<p>Item views in the QtWidgets module all inherit from <a href=\"https://doc.qt.io/qt-6/qabstractitemview.html\" rel=\"nofollow noreferrer\">QAbstractItemView</a>, which, in turn, inherits from <a href=\"https://doc.qt.io/qt-6/qabstractscrollarea.html\" rel=\"nofollow noreferrer\">QAbstractScrollArea</a>.<br />\nIn Qt, just like almost any GUI toolkit, scroll areas are <em>composite</em> widgets that always contain a &quot;viewport&quot;<sup>[1]</sup>: an actual <em>child widget</em> that acts as a <em>container</em>, showing the &quot;scrollable contents&quot;.</p>\n<p>The four most common standard item view classes (QListView, QTableView, QTreeView and QHeaderView<sup>[2]</sup>) are pretty straightforward: they always contain all their items <em>directly within</em> the <em>viewport</em> (the scroll <em>area</em>), therefore that viewport is usually the only actual widget furtherly involved with painting and UI interaction; Qt scroll areas are implicitly treated as a whole, and most events originally intended for their viewports are normally forwarded to the &quot;main&quot; widget (the &quot;main scroll area widget&quot;, or <em>&quot;the view&quot;</em>).</p>\n<p>Getting the <code>mouseMoveEvent()</code> from those standard views normally works by simply setting mouse tracking on the view (the &quot;main scroll area widget&quot;), and that's because:</p>\n<ul>\n<li>since most user events sent to the viewport are normally &quot;forwarded&quot; to the scroll area's related functions (by the event filter implicitly set on the viewport) no matter if they're accepted or not, they only require overriding the &quot;main&quot; class: for instance, <code>MouseMove</code> events sent to the viewport can be handled by the view's <code>mouseMoveEvent()</code>, even though they're not actually received by it;</li>\n<li>QAbstractScrollArea always implicitly sets the <a href=\"https://doc.qt.io/qt-6/qwidget.html#mouseTracking-prop\" rel=\"nofollow noreferrer\"><code>mouseTracking</code></a> property on the viewport whenever it's [un]set on it: the <code>event()</code> override of QAbstractScrollArea checks for <code>QEvent::MouseTrackingChange</code> events and updates the same property on the viewport accordingly;</li>\n</ul>\n<br>\n<p>On the other hand, QColumnView is a different beast: it is actually a <em>nested view</em>, made of multiple child QListViews: one QListView for each column, with each one representing the content of their parent index.<sup>[3]</sup></p>\n<p>This means that a mouse tracking property set on the &quot;top level&quot; QColumnView (and implicitly on its viewport) is not sufficient, for three reasons:</p>\n<ul>\n<li><code>MouseMove</code> events intended for the currently <a href=\"https://doc.qt.io/qt-6/qwidget.html#mouseGrabber\" rel=\"nofollow noreferrer\">&quot;grabbed widget&quot;</a> or the topmost one at the mouse position will always be <em>firstly</em> received by that widget, which in this case means the viewport of those nested views, <strong>not</strong> the viewport of the <em>main view</em>;</li>\n<li>those events are normally accepted by default;</li>\n<li>such events can only be propagated back to their parents <strong>only</strong> if they're being <em>ignored</em> by the widgets they were intended to: as soon as any object in their parent tree accepts that event, propagation of that event will stop permanently and will <em>never</em> be received by any parent;</li>\n</ul>\n<h1>Possible solutions</h1>\n<p>It may be enough to follow the <a href=\"https://stackoverflow.com/a/79830792/2001654\">other proposed solution</a>, which connects to the generated QListViews' <code>entered</code> signal when overriding <a href=\"https://doc.qt.io/qt-6/qcolumnview.html#createColumn\" rel=\"nofollow noreferrer\"><code>createColumn()</code></a>.</p>\n<p>Yet, there are cases for which more consistent mouse tracking may be needed; for instance, even if they come from the same index, or, most importantly, to detect if the mouse is moved <em>away from a valid index</em>: the <code>entered</code> signal is emitted only for valid indexes, so it's impossible to detect if the mouse is being moved on an empty area of a column, or even completely away from any column (eg: a scroll bar, the resize handle, or the preview area).</p>\n<h2>A proper event filter implementation</h2>\n<p>One possible option, partially similar to your latest attempt, is then to use a custom event filter for the QColumnView, which will be set in the <code>createColumn()</code> of the QColumnView subclass. Note that:</p>\n<ul>\n<li>the event filter object should be unique for the QColumnView subclass, probably created before anything else and, for obvious reasons, with the QColumnView instance as its parent;</li>\n<li>in <code>createColumn()</code> of the QColumnView subclass:\n<ol>\n<li>call the base implementation to get the common QListView created and set up by Qt;</li>\n<li>install the custom event filter on that view's viewport;</li>\n<li>return the newly created child view;</li>\n</ol>\n</li>\n<li>in the <code>eventFilter()</code> override of the filter, check the event type, and if it's a <code>MouseMove</code> then:\n<ol>\n<li>get the parent of the filtered object (<code>obj::parent()</code> in your <code>MyEventFilter</code> attempt) in order to get the actual QListView;</li>\n<li>call <code>indexAt()</code> on that parent, with the given <code>pos()</code><sup>[4]</sup> of the event, in order to get the proper index for that child view;</li>\n</ol>\n</li>\n<li>consider checking for <code>QEvent::Enter</code> and <code>QEvent::Leave</code> types in the filter as well and eventually do whatever needed accordingly;</li>\n</ul>\n<p>You may even create a custom signal for the filter (using a QModelIndex signature), so that you can connect it from the main QColumnView to whatever function you want, and emit it in the filter's <code>eventFilter()</code> above.</p>\n<h2>A possibly simpler way</h2>\n<p>In reality, though, there's probably an even simpler option, which is to take advantage of hover events, because <a href=\"https://doc.qt.io/qt-6/qhoverevent.html\" rel=\"nofollow noreferrer\">QHoverEvents</a> are <em>always</em> received by parents, even if ignored by the &quot;target&quot; widget that receives them:</p>\n<blockquote>\n<p>the event always propagates to the top-level regardless whether the event is accepted or not. It will only stop propagating with the Qt::WA_NoMousePropagation attribute.</p>\n</blockquote>\n<p>The procedure is quite simple, then:</p>\n<ol>\n<li>call <code>setAttribute(Qt::WA_Hover)</code> on the QColumnView subclass;</li>\n<li>override <code>event()</code> and check for <code>HoverMove</code> events, but possibly <code>HoverEnter</code> and <code>HoverLeave</code> ones as well;</li>\n<li>use <code>mapFromParent()</code> on the QColumnView's viewport with the hover event's <code>pos()</code> (also considering the mapped geometry of the viewport to avoid hover positions coming from events above sibling widgets such as scroll bars, or <code>HoverLeave</code> events).</li>\n</ol>\n<p><sup>[1] Other than the viewport, at the very least they also always contain a vertical and horizontal QScrollBar, even if it's not shown;</sup><br />\n<sup>[2] QHeaderView is peculiar in a different way, as it's mostly an &quot;accessory&quot; item view: it's normally never used standalone, but was still implemented as a QAbstractItemView since it shares most of aspects used by its &quot;sibling&quot; subclasses;</sup><br />\n<sup>[3] QColumnView actually contains other widgets, most importantly instances of a private QWidget subclass named <code>QColumnViewGrip</code> that is used to resize each column;</sup><br />\n<sup>[4] Since Qt6, most input events use <code>position()</code>, not <code>pos()</code>;</sup></p>\n", "tags": ["c++", "qt", "view", "qt6"]}
{"id": "73cd1a52-8bf7-4854-a310-d6cde438072a", "text": "Q: How to fix and parse dates based on unpatterened input formats A: <p>With the proviso, from comments, that the whole column is input in chronological order, and only under this condition, using <code>base</code> functions:</p>\n<pre><code>dates &lt;- c(&quot;2022-7-9&quot;, &quot;2022-9-12&quot;, &quot;9-14-2022&quot;, &quot;9-25-2022&quot;, &quot;26-9-2022&quot;, &quot;1-10-2022&quot;, &quot;6-10-2022&quot;, &quot;2022-10-8&quot;, &quot;2022-12-10&quot;)\n#indices\nymd_idx &lt;- which(as.numeric(as.Date(dates, format = '%Y-%m-%d')) &gt; 0)\n[1] 1 2 8 9\nydm_idx &lt;- which(as.numeric(as.Date(dates, format = '%Y-%d-%m')) &gt; 0)\n[1] 1 2 8 9\n# Dang, which are they? \nall(as.numeric(as.Date(dates[ymd_idx], format = '%Y-%m-%d')) == cummax(as.numeric(as.Date(dates[ymd_idx], format = '%Y-%m-%d'))))\n[1] TRUE\nall(as.numeric(as.Date(dates[ydm_idx], format = '%Y-%d-%m')) == cummax(as.numeric(as.Date(dates[ydm_idx], format = '%Y-%d-%m'))))\n[1] FALSE\n# they're %Y-%m-%d\n# dmy index\ndmy_idx &lt;- which(is.na(as.numeric(as.Date(dates, format = '%d-%m-%Y'))) == FALSE)\n[1] 5 6 7\n# Leaving\nmdy_idx &lt;- setdiff(1:length(dates), union(ymd_idx, dmy_idx))\n[1] 3 4\nas.numeric(as.Date(dates[mdy_idx], format = '%m-%d-%Y'))\n[1] 19249 19260\n</code></pre>\n<p>Well, kludgy in it's own way. The <code>all(</code>  test from <a href=\"https://stackoverflow.com/questions/13093912/how-to-check-if-a-sequence-of-numbers-is-monotonically-increasing-or-decreasing\">monotonically increasing</a> .</p>\n<p>Often we can be pretty deep into data collection before problems are identified, so an approach to creating lots of similar data:</p>\n<pre><code># data\nset.seed(42)\nall_dates &lt;- seq(as.Date('1984-01-01'), as.Date('2024-12-17'))\nall_dates_splt_vec &lt;- unlist(strsplit(as.character(all_dates), split = '-'))\ndates_ymd_mtx &lt;- matrix(all_dates_split_vec, nrow = length(all_dates), ncol = 3, byrow = TRUE)\ncols &lt;- c(1,2,3,1,3,2,2,3,1,3,2,1)\ncols_mtx &lt;- matrix(cols, nrow = 4, ncol = 3, byrow = TRUE)\nreceive_mtx &lt;- matrix(vector(mode = 'numeric', length = nrow(dates_ymd_mtx) * 8), nrow = nrow(dates_ymd_mtx), ncol = 8L)\nformats &lt;- c('%Y-%m-%d', '%Y-%d-%m', '%m-%d-%Y', '%d-%m-%Y')\np_smp &lt;- sample(1:4, nrow(dates_ymd_mtx), replace = TRUE)\nfor (k in 1:nrow(dates_ymd_mtx)) {\nfor (m in 1:nrow(cols_mtx)) {\nreceive_mtx[k, m + 4] &lt;- as.numeric(as.Date(paste(dates_ymd_mtx[k, cols_mtx[p_smp[k], ]], collapse = '-'), format = formats[m], optional = TRUE) )\n}\n}\n# likely useful to set negative integers to NA, mine are in col 5\nreceive_mtx[which(receive_mtx[, 5] &lt; 0), 5] &lt;- NA\n# now, create (random length?) gaps.\nbegin &lt;- seq(2,14962, 40)\nlast &lt;- seq(2,14962, 40) + sample(1:33, 375, replace = TRUE)\nfor (o in 1:375) {\n\n gap_lst[[o]] &lt;- begin[o]:last[o]\n\n }\n\nreceive_gaps &lt;- receive_mtx[-unlist(gap_lst), ]\n# At any point we could take out of chronological order and no,\n# don't know how I'll use columns 1:4, yet.\nrow_val_counts &lt;- vector(mode='numeric', length = nrow(receive_gaps) )\nfor (u in 1:nrow(receive_gaps)) {\nrow_val_counts[u] &lt;- length(which(is.na(receive_gaps[u, 5:8]) == TRUE) )\n}\ndecoded_idx &lt;- which(row_val_counts == 3L)\n# index which column contain decoded values \ndecoded_col &lt;- vector(mode = 'numeric', length= length(decoded_idx)\nfor (w in 1:length(decoded_idx)) {\n\ndecoded_col[w] &lt;- which(is.na(receive_gaps[decoded_idx[w], 5:8]) == FALSE) + 4\n\n }\n# put decoded values in 2nd column\nfor (w in 1:length(decoded_idx)) {\n\n receive_gaps[decoded_idx[w], 2] &lt;- receive_gaps[decoded_idx[w], decoded_col[w]]\n\n }\n\n\n\nambig_idx &lt;- which(row_val_counts == 2L)\n# check if ambiguous values are equal and copy to column 2\nfor (z in 1:length(ambig_idx)) {\nreceive_gaps[ambig_idx[z], 2] &lt;- ifelse(receive_gaps[ambig_idx[z], which(is.na(receive_gaps[ambig_idx[z], 5:8]) == FALSE) + 4][1] == receive_gaps[ambig_idx[z], which(is.na(receive_gaps[ambig_idx[z], 5:8]) == FALSE) + 4][2], receive_gaps[ambig_idx[z], which(is.na(receive_gaps[ambig_idx[z], 5:8]) == FALSE) + 4][1], NA)\n}\n# index receive_gaps[ambig_idx, 2] for remaining gaps\nambig_idx2 &lt;- which(is.na(receive_gaps[ambig_idx, 2]) == TRUE)\n</code></pre>\n", "tags": ["r", "date", "parsing", "lubridate"]}
