{"id": "b171efda-2f8b-4f9f-ac03-4740bfd3a8fc", "text": "Q: Keyed Collection in Python? A: <p>Below is my implementation.\nIn my use case, I need a sequence of records where one of the fields is a primary key. It's a part of a multi-layered internal data structure -- so I want the key to be an explicitly and prominently named field, or I quickly forget what exactly it contains.</p>\n<pre class=\"lang-py prettyprint-override\"><code>import typing\n\nT = typing.TypeVar('T', bound=typing.NamedTuple)\n\nK = typing.TypeVar('K', bound=typing.Hashable)\n\nclass KeyedList(typing.List[T], typing.Mapping[K, T]):\n    key_field: str\n    item_init: typing.Callable[[K], T] = None\n\n    def __init__(self, seq: typing.Union[typing.Iterable[T], None] = None):\n        super().__init__()\n        self._map = {}\n        if seq is not None:\n            self.__iadd__(seq)\n\n    # read\n\n    def __getitem__(self, key: K) -&gt; T:\n        return self._map[key]\n\n    def __contains__(self, key: K):\n        return key in self._map\n\n    # write\n\n    def append(self, item: T) -&gt; None:\n        key = self._getkey(item)\n        if key in self:\n            raise ValueError(f&quot;Key '{key:r}' already present&quot;)\n        super().append(item)\n        self._map[key] = item\n\n    def __iadd__(self, other: typing.Iterable[T]):\n        for item in other:\n            self.append(item)\n        return self\n\n    def __delitem__(self, key: K):\n        super().__delitem__(self[key])\n        del self._map[key]\n\n    def clear(self):\n        super().__delitem__(slice(None,None))\n        self._map.clear()\n\n    # read-write\n\n    def get_create(self, key: K):\n        try:\n            return self[key]\n        except KeyError as e:\n            if self.item_init is None:\n                raise AttributeError(&quot;'item_init' must be set to use automatic item creation&quot;) from e\n            item = self.item_init(key)\n            self.append(item)\n            return item\n\n    # info\n\n    def __repr__(self):\n        return self.__class__.__name__ + &quot;([&quot; + &quot;, &quot;.join(repr(i) for i in self) + &quot;])&quot;\n\n    # private\n\n    def _getkey(self, item: T) -&gt; K:\n        return getattr(item, self.key_field)\n\ndel T, K\n</code></pre>\n<p>The resulting hierarchical structure looks like this:</p>\n<pre class=\"lang-py prettyprint-override\"><code>class FooInfo(typing.TypedDict):\n    name: str\n    amount: int\n\nclass FooDirectory(KeyedList[FooInfo, str]):\n    key_field: &quot;name&quot;\n    item_init: lambda(name): FooInfo(name, 0)\n\nclass GeneralInfo(typing.NamedTuple):\n    general_id: str\n    data: FooDirectory\n\nclass GeneralDirectory(KeyedList[GeneralInfo, str]):\n    key_field: &quot;general_id&quot;\n\n&lt;...&gt;\ndirectory = GeneralDirectory()\ndirectory.append(GeneralInfo(&quot;some_entity&quot;, FooDirectory()))\ndirectory[&quot;some_entity&quot;][&quot;some_item&quot;]+=1\n&lt;etc&gt;\n</code></pre>\n", "tags": ["python", "keyedcollection"]}
{"id": "2ef4badc-2939-470f-a1a3-8ceeea68e6b6", "text": "Q: CSS Flexbox Issue A: <p>A possible solution is to append the title to the first flex box, or all others, when the later is chosen, apply <code>display:none</code> to all other titles elements.</p>\n<p>First, move the title below the <code>&lt;a&gt;</code> tag:</p>\n<pre class=\"lang-html prettyprint-override\"><code>&lt;body&gt;\n  &lt;div class=&quot;home-container&quot;&gt;\n    &lt;div class=&quot;flex-container&quot;&gt;\n&lt;!-- &lt;h3 class=&quot;heading flex-basis-1&quot;&gt;All Listings &lt;/h3&gt; --&gt;\n      &lt;div class=&quot;listings-container&quot;&gt;\n        &lt;a href=&quot;/listings/&lt;%= item._id %&gt;&quot;&gt;\n          &lt;div key=&quot;&lt;%= item._id %&gt;&quot; class=&quot;card-container &quot;&gt;\n            &lt;h3 class=&quot;heading flex-basis-1&quot;&gt;All Listings &lt;/h3&gt; &lt;!-- add this line --&gt;\n            &lt;img src=&quot;&lt;%= item.image.url %&gt;&quot; class=&quot;card-img&quot;/&gt;\n</code></pre>\n<p>This assures that &quot;the heading so its left edge always starts exactly aligned with the left edge of the first item.&quot;</p>\n<p>Adding <code>align-items:end</code> to the <code>.listing-container</code> will ensure each flexbox is positioned at the footer of it's flex-row:</p>\n<pre class=\"lang-css prettyprint-override\"><code>    .listings-container {\n        ..../*other styles*/\n        align-items: end;\n    }\n</code></pre>\n<p>Its unclear why you specify the height of each .card-container here, but that must be removed if this stylesheet is to achieve the project goals:</p>\n<pre class=\"lang-css prettyprint-override\"><code>.card-container {\n  /*height: 20rem;*/\n  ..../*other styles*/\n}\n</code></pre>\n<p>These two styles ensure only the first title is displayed:</p>\n<pre class=\"lang-css prettyprint-override\"><code>    .heading {\n        display: none\n    }\n\n    .listings-container a:first-child .heading {\n        display: block\n    }\n</code></pre>\n<p>Please see the goal achieved in this screenshot:</p>\n<p><a href=\"https://i.sstatic.net/fzXzevD6.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/fzXzevD6.png\" alt=\"Answer screenshot in chrome dev tools\" title=\"Answer screenshot in chrome dev tools\" /></a></p>\n<p>Full document:</p>\n<pre><code></code></pre>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\" data-babel-preset-react=\"false\" data-babel-preset-ts=\"false\">\n<div class=\"snippet-code\">\n<pre class=\"snippet-code-css lang-css prettyprint-override\"><code>.home-container {\n  padding: 28px;\n  margin-left: auto;\n  margin-right: auto;\n  max-width: 90vw;\n}\n\n.flex-container {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n  width: fit-content;\n  align-items: flex-start;\n}\n\n.listings-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 16px;\n  width: 100%;\n  justify-content: center;\n  width: fit-content !important;\n  align-items: end;\n}\n\n.heading {\n  font-size: 18px;\n  color: #222;\n  font-weight: 600;\n}\n\n.card-container {\n  /*height: 20rem;*/\n  width: 18rem;\n  cursor: pointer;\n}\n\n.card-img {\n  width: stretch;\n  height: 16rem;\n  border-radius: 1rem;\n  margin-bottom: 10px;\n}\n\n.heading {\n  display: none\n}\n\n.listings-container a:first-child .heading {\n  display: block\n}</code></pre>\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;div class=\"home-container\"&gt;\n  &lt;div class=\"flex-container\"&gt;\n    &lt;div class=\"listings-container\"&gt;\n      &lt;a href=\"/listings/&lt;%= item._id %&gt;\"&gt;\n        &lt;div key=\"&lt;%= item._id %&gt;\" class=\"card-container \"&gt;\n            &lt;h3 class=\"heading flex-basis-1\"&gt;All Listings &lt;/h3&gt;\n            &lt;img src=\"&lt;%= item.image.url %&gt;\" class=\"card-img\"/&gt;\n            &lt;div&gt;\n                &lt;div class=\"card-heading\"&gt;Title&lt;/div&gt;\n                &lt;div class=\"card-text\"&gt;Card text&lt;/div&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/a&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/div&gt;</code></pre>\n</div>\n</div>\n</p>\n", "tags": ["html", "css", "flexbox", "ejs"]}
{"id": "6c8c4a3f-2004-4f6b-ac0f-8349e956d2a5", "text": "Q: pd.Timestamp has attribute .isoformat, but the series accessor .dt does not A: <h3>Understanding</h3>\n<p>Accessors don't just forward calls to each object in the Series. In fact, a datetime column doesn't actually &quot;contain&quot; <code>Timestamp</code> objects per se; instead they're converted to <strong>binary</strong> and stored in an array with <code>datetime64</code> dtype. <code>Timestamp</code> is a wrapper class for when you need to work with them as scalars.</p>\n<p>So, for an accessor to have a method, it needs to be specifically written with the <em>underlying array</em> in mind.</p>\n<h3>So why not have <code>.dt.isoformat()</code>?</h3>\n<p>I think <code>.isoformat</code> isn't available on <code>.dt</code> because it's a <strong>dynamic</strong> format. See docs for <a href=\"https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.isoformat.html\" rel=\"nofollow noreferrer\"><code>Timestamp.isoformat</code></a>:</p>\n<blockquote>\n<p>The full format looks like \u2018YYYY-MM-DD HH:MM:SS.mmmmmmnnn\u2019. By default, <strong>the fractional part is omitted</strong> if self.microsecond == 0 and self.nanosecond == 0.</p>\n<p>If self.tzinfo is not None, <strong>the UTC offset is also attached</strong>, giving giving a full format of \u2018YYYY-MM-DD HH:MM:SS.mmmmmmnnn+HH:MM\u2019.</p>\n</blockquote>\n<p>So, as a workaround, you could use <code>.dt.strftime()</code> instead. In this case, the equivalent of 'YYYY-MM-DD HH:MM:SS' is <code>%Y-%m-%d %H:%M:%S</code>:</p>\n<pre><code>df[&quot;timestamp&quot;].dt.strftime('%Y-%m-%dT%H:%M:%S')\n</code></pre>\n<pre class=\"lang-none prettyprint-override\"><code>0    2024-01-01T00:00:00\n1    2024-01-02T00:00:00\nName: timestamp, dtype: object\n</code></pre>\n<ul>\n<li>To be more thorough is complicated, so I'll cover that below.</li>\n</ul>\n<p>Or, Pandas displays datetimes in ISO format by default, so you could use <code>.astype(str)</code> if you're fine with the format being even more dynamic (in this case, no time):</p>\n<pre><code>df[&quot;timestamp&quot;].astype(str)\n</code></pre>\n<pre class=\"lang-none prettyprint-override\"><code>0    2024-01-01\n1    2024-01-02\nName: timestamp, dtype: object\n</code></pre>\n<ul>\n<li>I guess considering this, there's no reason <code>.dt.isoformat()</code> <em>couldn't</em> exist, as long as there's an understanding that it's inherently dynamic. You could put in a feature request or pull request to Pandas <a href=\"https://github.com/pandas-dev/pandas\" rel=\"nofollow noreferrer\">on GitHub</a>.</li>\n</ul>\n<h4>More thorough with strftime</h4>\n<p>The <a href=\"https://docs.python.org/3/library/datetime.html#format-codes\" rel=\"nofollow noreferrer\">strftime format codes</a> don't support nanoseconds, only microseconds, while for UTC offset, they actually have <em>more</em> precision (<em>&quot;<code>%z</code> UTC offset in the form <code>\u00b1HHMM[SS[.ffffff]]</code> (empty string if the object is naive)&quot;</em>).</p>\n<p>You could write a helper function that adds microseconds and nanoseconds as needed based on whether <em>all</em> elements have microsecond/nanosecond == 0. Unfortunately for nanoseconds, you'll have to format them manually: something like <code>.dt.nanosecond.astype(str).str.rjust(3, '0')</code>. Alternatively, you could use your lambda, but specify <code>timespec=</code> as either <code>'seconds'</code>, <code>'microseconds'</code>, or <code>'nanoseconds'</code>.</p>\n<p>For testing, here's a Series with each precision and a NaT. You can slice it up to the desired precision (<code>.iloc[:n]</code>):</p>\n<pre><code>datetime_precisions = pd.Series(\n    [\n        &quot;2024-01-01&quot;,\n        &quot;2024-01-02&quot;,\n        &quot;2024-01-03T01&quot;,\n        &quot;2024-01-03T01:01&quot;,\n        &quot;2024-01-03T01:01:01&quot;,\n        &quot;2024-01-03T01:01:01.123456&quot;,\n        &quot;2024-01-03T01:01:01.123456789&quot;,\n        &quot;NaT&quot;],\n    dtype='datetime64[ns]')\n</code></pre>\n", "tags": ["python", "pandas", "timestamp", "iso8601"]}
{"id": "44278785-f6f7-4438-ad97-aad461515cca", "text": "Q: I&#39;m a beginner learner and i&#39;d like some feedback on this really simple program calculating an employee&#39;s pay A: <p>Your code works perfectly fine, but you don't need two separate exceptions. You can also use one line for each input from the user.</p>\n<p>Another slight modification could be writing the print statement only once. You can define the pay before the if statement, and only add the overpay if the hours are above 40, then print the total afterwards.</p>\n<p>This cuts down the lines of code slightly and lowers the number of operations in every case, making it a bit more efficient when it runs. Obviously, the difference is unnoticeable in your program, but in large scale programs, having fewer operations in your functions will have a big impact.</p>\n<p>Here is what my modifications would look like:</p>\n<pre><code>try:\n    hours = float(input(&quot;Enter hours: &quot;))\n    rate = float(input(&quot;Enter rate: &quot;))\nexcept:\n    print('Please enter a valid number')\n    quit()\n\npay = hours * rate\n\nif hours &gt; 40:\n    overtime = hours - 40\n    overpay = overtime * rate * 0.5\n    pay += overpay\n\nprint(&quot;Pay: &quot; + str(pay))\n</code></pre>\n", "tags": ["python"]}
{"id": "15f4a587-50e5-495e-814e-3a4db95cb133", "text": "Q: How to add appropriate light in the scene? A: <p>ar ambientLight = new THREE.AmbientLight(0x222222);</p>\n<p>scene.add(ambientLight);</p>\n<p>// add directional light source</p>\n<p>var directionalLight = new THREE.DirectionalLight(0xffffff,2);</p>\n<p>directionalLight.position.set(1, 1, 1).normalize();</p>\n<p>scene.add(directionalLight);</p>\n<p>var directionalLight1 = new THREE.DirectionalLight(0xffffff);</p>\n<p>directionalLight1.position.set(-1, -1, -1).normalize();</p>\n<p>scene.add(directionalLight1);</p>\n", "tags": ["model", "three.js", "light", "collada"]}
{"id": "b8f75cc8-3954-40aa-909c-d6397be28521", "text": "Q: Valgrind on macOS Ventura 13.0 A: <p>Valgrind is not supported on macOS 13.0.</p>\n<p>The last officially supported version is 10.14. There is no support at all for Apple silicon.</p>\n<p>Some support for macOS versions after 10.14 is available here <a href=\"https://github.com/LouisBrunner/valgrind-macos\" rel=\"nofollow noreferrer\">https://github.com/LouisBrunner/valgrind-macos</a></p>\n<p>I am actively working on the macOS port at the moment. There is a lot of work still to be done.</p>\n<p>Your best bet, if your software is portable to other OSes, is to test it on FreeBSD or Linux.</p>\n", "tags": ["valgrind", "macos-ventura"]}
{"id": "db851520-947a-4aeb-9eaf-77d3308627d5", "text": "Q: Preserve Latex-commands in Pretty Table printing to latex A: <p>One way to include strings containing LaTeX code in the data given to <code>pretty_tables</code> while using the <code>:latex</code> back end is to:</p>\n<p>Wrap strings containing LaTeX code with the <a href=\"https://ronisbr.github.io/PrettyTables.jl/stable/lib/library/#PrettyTables.LatexCell\" rel=\"nofollow noreferrer\"><code>PrettyTables.LatexCell</code></a> struct.</p>\n<p>Either</p>\n<ul>\n<li><code>LatexCell(&quot;...&quot;)</code> which calls the constructor directly, or</li>\n<li><code>latex_cell&quot;...&quot;</code> which uses the custom <a href=\"https://docs.julialang.org/en/v1/manual/metaprogramming/#meta-non-standard-string-literals\" rel=\"nofollow noreferrer\">string literal</a> of the <a href=\"https://ronisbr.github.io/PrettyTables.jl/stable/lib/library/#PrettyTables.@latex_cell_str-Tuple%7BAny%7D\" rel=\"nofollow noreferrer\"><code>@latex_cell_str</code></a> macro.</li>\n</ul>\n<h3>Call the <code>LatexCell</code> constructor</h3>\n<pre><code>import PrettyTables: pretty_table, LatexCell\n\n# Your data with pre-formatted LaTeX\ndata = [LatexCell(&quot;Br{\\\\\\\\\\&quot;o}dbit&quot;) &quot;Sweden&quot;]\nprintln(data)\n\n# WISH: Print the table to the console as LaTeX with Latex preserved\n\npretty_table(\n    data,\n    backend = :latex\n)\n\n# Any[LatexCell{String}(&quot;Br{\\\\\\\\\\&quot;o}dbit&quot;) &quot;Sweden&quot;]\n# \\begin{tabular}{|r|r|}\n#   \\hline\n#   \\textbf{Col. 1} &amp; \\textbf{Col. 2} \\\\\n#   \\hline\n#   Br{\\\\&quot;o}dbit &amp; Sweden \\\\\n#   \\hline\n# \\end{tabular}\n</code></pre>\n<h3>Use the <code>@latex_cell_str</code> string literal macro</h3>\n<pre><code>import PrettyTables: pretty_table, @latex_cell_str\n\n# Your data with pre-formatted LaTeX\ndata = [latex_cell&quot;Br{\\\\\\\\\\&quot;o}dbit&quot; &quot;Sweden&quot;]\nprintln(data)\n\n# WISH: Print the table to the console as LaTeX with Latex preserved\n\npretty_table(\n    data,\n    backend = :latex\n)\n\n# Any[PrettyTables.LatexCell{String}(&quot;Br{\\\\\\\\\\&quot;o}dbit&quot;) &quot;Sweden&quot;]\n# \\begin{tabular}{|r|r|}\n#   \\hline\n#   \\textbf{Col. 1} &amp; \\textbf{Col. 2} \\\\\n#   \\hline\n#   Br{\\\\&quot;o}dbit &amp; Sweden \\\\\n#   \\hline\n# \\end{tabular}\n</code></pre>\n", "tags": ["julia", "prettytable"]}
{"id": "3b381242-88ca-40a8-94b7-a5f7396281c7", "text": "Q: I am getting an error from the javascript code: var context = document.getElementById(&quot;gameCanvas&quot;).getContext(&quot;2d&quot;); A: <p>This is because you have misspelt your canvas tag:</p>\n\n<pre><code>&lt;canavs id=\"gameCanvas\"&gt;&lt;/canvas&gt;\n</code></pre>\n\n<p>Should be:</p>\n\n<pre><code>&lt;canvas id=\"gameCanvas\"&gt;&lt;/canvas&gt;\n</code></pre>\n", "tags": ["javascript", "html", "canvas"]}
