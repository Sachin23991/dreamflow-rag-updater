{"id": "1d8d4e76-736a-4030-b4ea-eb68b38c48cf", "text": "Q: How to UPSERT (update or insert into a table?) A: <p>None of the answers given so far is <strong>safe in the face of concurrent accesses</strong>, as pointed out in Tim Sylvester's comment, and will raise exceptions in case of races. To fix that, the insert/update combo must be wrapped in some kind of loop statement, so that in case of an exception the whole thing is retried.</p>\n<p>As an example, here's how <a href=\"https://stackoverflow.com/a/2692441/307525\">Grommit's code</a> can be wrapped in a loop to make it safe when run concurrently:</p>\n<pre><code>PROCEDURE MyProc (\n ...\n) IS\nBEGIN\n LOOP\n  BEGIN\n    MERGE INTO Employee USING dual ON ( &quot;id&quot;=2097153 )\n      WHEN MATCHED THEN UPDATE SET &quot;last&quot;=&quot;smith&quot; , &quot;name&quot;=&quot;john&quot;\n      WHEN NOT MATCHED THEN INSERT (&quot;id&quot;,&quot;last&quot;,&quot;name&quot;) \n        VALUES ( 2097153,&quot;smith&quot;, &quot;john&quot; );\n    EXIT; -- success? -&gt; exit loop\n  EXCEPTION\n    WHEN NO_DATA_FOUND THEN -- the entry was concurrently deleted\n      NULL; -- exception? -&gt; no op, i.e. continue looping\n    WHEN DUP_VAL_ON_INDEX THEN -- an entry was concurrently inserted\n      NULL; -- exception? -&gt; no op, i.e. continue looping\n  END;\n END LOOP;\nEND; \n</code></pre>\n<p>N.B. In transaction mode <code>SERIALIZABLE</code>, which I don't recommend btw, you might run into\n<a href=\"https://stackoverflow.com/questions/19923171/how-to-make-merge-serializable/\">ORA-08177: can't serialize access for this transaction</a> exceptions instead.</p>\n", "tags": ["sql", "oracle-database", "merge", "upsert"]}
{"id": "82f65748-d08d-4028-9e03-092d67029ceb", "text": "Q: Arecord-&gt;FFMPEG works but FFMPEG w/ ALSA stutters? A: <p>I know this is a very old question, but I'd like to share the following  which worked for me:</p>\n<pre><code>ffplay -f alsa -i hw:card,device -ar [specify sample rate]\n</code></pre>\n<p>Where <code>ffplay</code> is an FFmpeg program that sends data directly to your chosen speaker with SDL.</p>\n<p>In my case, using a sample rate of 44100 removed the stutter, as my capture card couldn't output the audio as fast as FFmpeg wanted it.</p>\n", "tags": ["ffmpeg", "raspberry-pi", "alsa"]}
{"id": "9dba41f0-f932-4aa7-bb8c-c87b6c05dd50", "text": "Q: How to ignoreSafeArea when presenting content in SwiftUI Sheet? A: <p>The modifier <code>.ignoresSafeArea</code> only makes a difference when it is applied to content that is <em>actually in contact with the safe area edge</em>. So try applying <code>.frame(maxWidth: .infinity, maxHeight: .infinity)</code> to the content being shown, <em>before</em> applying <code>.ignoresSafeArea</code>.</p>\n<hr />\n<p>To test this, I needed to make the following changes/fixes to the code in your example:</p>\n<ul>\n<li>In <code>RootSheetWrapper</code>, create an instance of <code>SheetViewModel</code>. This should also be <code>private</code>:</li>\n</ul>\n<pre class=\"lang-swift prettyprint-override\"><code>struct RootSheetWrapper: View {\n    @StateObject private var viewModel = SheetViewModel() // \ud83d\udc48 here\n\n    var body: some View {\n        // ... as before\n    }\n}\n</code></pre>\n<ul>\n<li>In <code>customTransparentSheet</code>, remove the <code>self.</code> on the sheet modifier:</li>\n</ul>\n<pre class=\"lang-swift prettyprint-override\"><code>extension View {\n    func customTransparentSheet&lt;Content: View&gt;(/*...*/) -&gt; some View {\n        ZStack {\n            // ... as before\n        }\n        .sheet(isPresented: isPresented) { // \ud83d\udc48 self. removed\n            // ... as before\n        }\n    }\n}\n</code></pre>\n<ul>\n<li>The view <code>SomeOverlay</code> is missing, here is an improvised implementation:</li>\n</ul>\n<pre class=\"lang-swift prettyprint-override\"><code>struct SomeOverlay: View {\n    var body: some View {\n        Color.red\n            .ignoresSafeArea()\n    }\n}\n</code></pre>\n<ul>\n<li>Instead of launching the view using your function <code>presentSheet</code>, I tried testing with the following improvised version of <code>ContentView</code>:</li>\n</ul>\n<pre class=\"lang-swift prettyprint-override\"><code>struct ContentView: View {\n    var body: some View {\n        RootSheetWrapper()\n    }\n}\n</code></pre>\n<hr />\n<p>Now down to business.</p>\n<ul>\n<li><p>In <code>SheetContent</code>, you are showing an image scaled to fill, which may cause overflow. I would suggest using scaled-to-fit for testing.</p>\n</li>\n<li><p>The modifier <code>.ignoresSafeArea()</code> can be un-commented.</p>\n</li>\n<li><p>The <code>.frame</code> modifier described earlier needs to be applied <em>before</em>  <code>.ignoresSafeArea</code>. Use <code>alignment: .bottom</code> if you want the star to be pushed to the bottom of the screen (and into the safe area).</p>\n</li>\n</ul>\n<p>Here is the updated version of <code>SheetContent</code>:</p>\n<pre class=\"lang-swift prettyprint-override\"><code>struct SheetContent: View {\n    var body: some View {\n        VStack(spacing: 0) {\n            // This image should sit behind the home indicator\n            Image(systemName: &quot;star.fill&quot;)\n                .resizable()\n                .scaledToFit() // \ud83d\udc48 changed to scale-to-fit for testing\n        }\n        .frame(maxWidth: .infinity, maxHeight: .infinity, alignment: .bottom) // \ud83d\udc48 added\n        .ignoresSafeArea() // \ud83d\udc48 un-commented\n    }\n}\n</code></pre>\n<p><img src=\"https://i.sstatic.net/0kDeIL9Ct.png\" alt=\"Screenshot\" /></p>\n<p>The screenshot is from an iPhone 16 simulator running iOS 18.5. As you can see, the star is occupying the bottom safe area and is using the same part of the screen as the home bar.</p>\n<hr />\n<p>Some more notes:</p>\n<ul>\n<li><p>With iOS 26, the sheet background cannot be made transparent. See <a href=\"https://stackoverflow.com/q/79830955/20386264\">Using .presentationBackground(_: Style), but default sheet background is still visible</a> for possible workarounds.</p>\n</li>\n<li><p>If you really want to show the image scaled-to-fill, try showing it as an overlay over <code>Color.clear</code> and clip the result:</p>\n</li>\n</ul>\n<pre class=\"lang-swift prettyprint-override\"><code>Color.clear\n    .overlay {\n        Image(systemName: &quot;star.fill&quot;)\n            .resizable()\n            .scaledToFill()\n    }\n    .clipped()\n</code></pre>\n<p>See <a href=\"https://stackoverflow.com/a/79341688/20386264\">this answer</a> for an explanation.</p>\n", "tags": ["ios", "swift", "swiftui"]}
{"id": "308af59d-bf93-4a21-99d9-e963ba975076", "text": "Q: Setting up a Rails app in devcontainer with Capybara and Playwright for headless and non-headless system rspec tests A: <h1>Simple devcontainer Rails App - Code Explanations (The final code is in the other answer)</h1>\n<h2>Using RSpec, capybara, and playwright for system tests, and allowing non-headless browser observation via VNC</h2>\n<h3>Shout-out to Gemini and Claude for helping me sort this out</h3>\n<p>This answer includes some of the code explanation for the code in the other answer.  StackOverflow limits the size of an answer, so I broke it into two.</p>\n<p>This is how I set up a simple Rails app.  I also have a similar Github repository at <a href=\"https://github.com/nachbar/rails_capybara_playwright\" rel=\"nofollow noreferrer\">https://github.com/nachbar/rails_capybara_playwright</a>. You will need to have Docker and Visual Studio Code (with the devcontainer extension) installed to follow along.</p>\n<p>I wanted to be able to do system tests within a devcontainer, and using RSpec, capybara, playwright, and to be able to view the tests running in the browser over a VNC connection.</p>\n<p>I also wanted to be able to make screenshots and create playwright trace files.</p>\n<p>In practice, however, the non-headless feature is probably not as important as I had thought, given the effectiveness of the playwright trace files.</p>\n<p>Although I could not get the playwright trace viewer to run within the devcontainer, there are other ways to use the Playwright Trace Viewer, and probably none easier than using the online viewer tool at <a href=\"https://trace.playwright.dev\" rel=\"nofollow noreferrer\">https://trace.playwright.dev</a></p>\n<h3>Creating the Ruby on Rails app with rails-new</h3>\n<p>To create the new Rails app, I used the &quot;rails-new&quot; application from <a href=\"https://github.com/rails/rails-new\" rel=\"nofollow noreferrer\">https://github.com/rails/rails-new</a></p>\n<p>rails-new allows you to create the rails app even without having ruby and/or rails installed on your system.  See their docs for prerequisites, which mostly include Docker - I used Docker Desktop on my Intel MacBook.</p>\n<p>On the rails-new site, the compiled applications are on the releases page at <a href=\"https://github.com/rails/rails-new/releases\" rel=\"nofollow noreferrer\">https://github.com/rails/rails-new/releases</a> .</p>\n<p>The trick is to find the &quot;Assets&quot; disclosure triangle and click on it to show the available versions.  Until you click that triangle, you will not see the versions.</p>\n<p>As of rails-new v0.5.0 (16 Jan 2025), rails-new automatically downloads the latest available version of rails to the container, so you don't have to wait until a new version of rails-new is generated to be able to use the most current version of rails.</p>\n<p>Alternatively, you could create the app with <code>rails new</code>, or however you want, or you could start with an existing project to add this functionality.</p>\n<p>I included the steps I used as commit messages in the repository <a href=\"https://github.com/nachbar/rails_capybara_playwright\" rel=\"nofollow noreferrer\">https://github.com/nachbar/rails_capybara_playwright</a>.</p>\n<p>After you generate the application with the <code>--devcontainer</code> option, when you open that new application's folder with the Visual Studio Code devcontainer extension installed, the extension notices that there is a devcontainer configuration, and offers to build and connect to the devcontainer.</p>\n<p>Use <code>File / Open Folder ...</code> to open the new app in Visual Studio Code, and click the button in the lower right to <code>Reopen in Container</code>. Once the project has been reopened, you can use Code's Terminal / New Terminal to open a bash shell in the filesystem within the devcontainer.</p>\n<p>To control the container, including rebuiling the container to reflect changes, click on the blue <code>Dev Container</code> button in the lower left to open the menu of devcontainer operations.</p>\n<p>The first time you use that menu to <code>Rebuild Container</code>, you may get an exception with the error:</p>\n<pre><code>Error response from daemon: No such image: ghcr.io/rails/devcontainer/images/ruby:3.4.8\n</code></pre>\n<p>This is because the rails generation calls out a ruby version that does not yet exist at ghcr.io .  You can resolve that by editing <code>.devcontainer/Dockerfile</code> and change:</p>\n<pre><code>FROM ghcr.io/rails/devcontainer/images/ruby:$RUBY_VERSION\n</code></pre>\n<p>to</p>\n<pre><code>FROM ruby:$RUBY_VERSION\n</code></pre>\n<p>You may then get the error:</p>\n<pre><code>Error: unable to get issuer certificate\n</code></pre>\n<p>This is due to ghcr.io still being referenced in the features.  You can resolve that by removing the automatic feature downloading, and add the features manually in the Dockerfile.</p>\n<p>Edit <code>.devcontainer/devcontainer.json</code> and remove</p>\n<pre><code>&quot;features&quot;: { \n  &quot;ghcr.io/devcontainers/features/github-cli:1&quot;: {},  \n  &quot;ghcr.io/rails/devcontainer/features/activestorage&quot;: {},\n  &quot;ghcr.io/devcontainers/features/docker-outside-of-docker:1&quot;: {&quot;moby&quot;:false}, \n  &quot;ghcr.io/rails/devcontainer/features/postgres-client&quot;: {} \n   },  \n</code></pre>\n<p>replacing it with:</p>\n<pre><code>// Disabled features due to SSL certificate issues - installing manually in Dockerfile instead                              \n// &quot;features&quot;: {},\n</code></pre>\n<p>Then, add the following to the <code>Dockerfile</code>:</p>\n<pre><code># Install system dependencies, otherwise installed via features, not working because of different ruby image\nRUN apt-get update &amp;&amp; apt-get install -y \\\n    postgresql-client \\\n    git \\\n    curl \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n\n# Install GitHub CLI\nRUN curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg \\\n    &amp;&amp; chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg \\\n    &amp;&amp; echo &quot;deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main&quot; | tee /etc/apt/sources.list.d/github-cli.list &gt; /dev/null \\\n    &amp;&amp; apt-get update \\\n    &amp;&amp; apt-get install -y gh \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n\nRebuilding the container will update the gems, but otherwise you can run `bundle` within the bash shell within the container.\n\nNote that you probably cannot (and should not) run `bundle` in your regular terminal (i.e. outside of Visual Studio Code) because yo likely do not have the correct Ruby version installed outside the container.\n\n</code></pre>\n<p>To install playwright, add to <code>.devcontainer/Dockerfile</code> :</p>\n<pre><code># === Install Node.js (LTS version recommended) ===\n# Set desired Node.js version (e.g., 22 in early 2025)\n# Check https://github.com/nodesource/distributions for current setup scripts\nARG NODE_MAJOR=22\nENV NODE_MAJOR=${NODE_MAJOR}\n\n# Install dependencies needed for NodeSource setup and potentially other tools\nRUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends \\\n    curl \\\n    gnupg \\\n    ca-certificates \\\n &amp;&amp; rm -rf /var/lib/apt/lists/*\n\n\n# Add NodeSource repository and install Node.js\nRUN curl -fsSL https://deb.nodesource.com/setup_${NODE_MAJOR}.x | bash - \\\n&amp;&amp; apt-get update &amp;&amp; apt-get install -y nodejs \\\n&amp;&amp; rm -rf /var/lib/apt/lists/*\n# Verify installation (optional, removed in final image)\n# RUN node -v &amp;&amp; npm -v &amp;&amp; npx -v\n# === End Node.js Installation ===\n\n# Install dependencies\nRUN apt-get update -qq &amp;&amp; apt-get install -y --no-install-recommends \\\n    nodejs postgresql-client libpq-dev \\\n    libnss3 \\\n    libatk1.0-0 \\\n    libatk-bridge2.0-0 \\\n    libgtk-3-0 \\\n    libgbm-dev \\\n    libasound2 \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n</code></pre>\n<p>You have to install playwright in <code>devcontainer.json</code> rather than <code>Dockerfile</code>, so it uses the correct user to install playwright</p>\n<p>Change the <code>postCreateCommand</code> in <code>.devcontainer/devcontainer.json</code> to:</p>\n<pre><code>&quot;postCreateCommand&quot;: &quot;bin/setup --skip-server  &amp;&amp;  sudo apt-get update &amp;&amp; sudo apt-get install -y xvfb x11vnc fluxbox xterm dbus-x11 libnss3 libatk1.0-0 libatk-bridge2.0-0 libgtk-3-0 libgbm-dev libasound2 &amp;&amp; npm install playwright &amp;&amp; npx playwright install --with-deps chromium&quot;\n</code></pre>\n<p>That will also allow you to use non-headless mode if you want.  If you do not want non-headless mode, you can simplify that to:</p>\n<pre><code>&quot;postCreateCommand&quot;: &quot;bin/setup --skip-server  &amp;&amp;  sudo apt-get update &amp;&amp; sudo apt-get install -y libnss3 libatk1.0-0 libatk-bridge2.0-0 libgtk-3-0 libgbm-dev libasound2 &amp;&amp; npm install playwright &amp;&amp; npx playwright install --with-deps chromium&quot;\n</code></pre>\n<p>You will also want to update <code>spec/rails_helper.rb</code> (the final version is in the other answer) to be able to use capybara and playwright.  Before <code>RSpec.configure do |config|</code>, add:</p>\n<pre><code># For capybara and playwright\nrequire 'capybara/rspec'\nrequire 'capybara/playwright' # Require the playwright driver\n</code></pre>\n<p>And within the RSpec.configure block, add:</p>\n<pre><code> # Make Capybara DSL available in system specs\n  config.include Capybara::DSL, type: :system\n\n  # Set the default driver to Playwright\n  Capybara.default_driver = :playwright\n  # Also use Playwright for tests tagged with :js\n  Capybara.javascript_driver = :playwright\n\n  # Configure the Playwright driver\n  Capybara.register_driver :playwright do |app|\n    Capybara::Playwright::Driver.new(\n      app,\n      # Select the browser: :chromium, :firefox, or :webkit\n      browser_type: :chromium,\n      # Run in headless mode (no visible browser window) - Recommended for containers/CI\n      headless: true, # Set to false if you somehow have X11 forwarding/VNC setup for debugging\n      # You might need to adjust timeouts depending on your app and container performance\n      # page_settings: { default_navigation_timeout: 10_000, default_timeout: 5_000 },\n      # Other Playwright launch options can go here if needed\n      # launch_options: { slow_mo: 50 } # Example: slows down execution for observation\n    )\n  end\n\n  # == IMPORTANT: Devcontainer Network Configuration ==\n  # Tell Capybara to bind the Rails server to all interfaces within the container\n  Capybara.server_host = '0.0.0.0'\n\n  # Tell Capybara how the browser (running inside the container) can reach the Rails server (also inside)\n  # Option 1: If using docker-compose, use the service name and port\n  # Replace 'web' with the name of your Rails app service in docker-compose.yml\n  # Replace '3000' with the port your Rails app runs on *inside* the container\n  # Capybara.app_host = &quot;http://web:3000&quot;\n\n  # Option 2: If *not* using docker-compose (single container), localhost might work if the port is exposed\n  # Capybara.app_host = &quot;http://localhost:3000&quot; # Check your setup\n\n  # Determine the correct app_host based on your devcontainer setup (docker-compose or single container).\n  # Often, using the server_port is sufficient if host is set correctly\n  Capybara.server_port = 3010 # Use a different port for testing than your standard dev port (3000)\n  Capybara.app_host = &quot;http://#{IPSocket.getaddress(Socket.gethostname)}:#{Capybara.server_port}&quot;\n\n\n  # == System Test Configuration ==\n  config.before(:each, type: :system) do\n    # Use the :playwright driver for system tests by default\n\n    # NOTE: to run system tests in a non-headless mode, you can use the :playwright_non_headless driver\n    driven_by :playwright\n    # driven_by :playwright_non_headless\n  end\n\n  # Optional: Configure Playwright page options for system tests\n  # config.before(:each, type: :system, js: true) do\n  #   page.driver.browser.contexts.first.set_default_navigation_timeout(10_000) # Example\n  # end\n\n  #\n</code></pre>\n<p>Now that you are including node, you want to exclude node modules from your git.  Add to .gitignore:</p>\n<pre><code># Do not include node_modules\n/node_modules/*\n</code></pre>\n<p>You will also need to add <code>sudo</code> to the packages being installed, because of the way playwright is being installed.  Add to <code>.devcontainer/Dockerfile</code>:</p>\n<pre><code>   sudo \\\n</code></pre>\n<h3>Using Non-Headless Mode</h3>\n<p>To use the non-headless mode, so you can watch the tests as they occur, you first need to add port 5901 <code>forwardPorts</code> in <code>.devcontainer/devcontainer.json</code>:</p>\n<pre><code> // add 5901 to allow non-headless via VNC.  If you don't need VNC, you can remove it.\n  &quot;forwardPorts&quot;: [3000, 5432, 5901],\n</code></pre>\n<p>To run your tests, see the instructions in <code>spec/rails_helper.rb</code> to change <code>driven_by</code> within the system test configuration within the RSpec.configure block in <code>spec/rails_helper.rb</code> from <code>driven_by :playwright</code> to <code>driven_by :playwright_non_headless</code></p>\n<p>Of the VNC viewers:\nThe MacBook Screen Sharing asks for a password, and I could not get it to work with this setup.  However, using TigerVNC Viewer on the MacBook, I was able to connect to the VNC server and see the browser.</p>\n<p>You can install TigerVNC Viewer using <code>brew install --cask tigervnc-viewer</code></p>\n<p>Then, you can run it from the Applications folder (TigerVNC Viewer), and connect to localhost:5901</p>\n<p>Another option is to use RealVNC viewer.  After installation, RealVNC Viewer is in the Applications folder as &quot;VNC Viewer&quot;</p>\n<p>When running the system tests, from a devcontainer terminal, use:</p>\n<pre><code>DISPLAY=:1 rspec spec/system/\n</code></pre>\n<p>You can also use <code>xterm</code> with:</p>\n<pre><code>DISPLAY=:1 xterm\n</code></pre>\n<p><code>xterm</code> does not play well with the vncviewer that homebrew installs with <code>brew install tiger-vnc</code>, and requires manual refreshes.  The TigerVNC viewer app and RealVNC viewer app both work well with xterm and also refresh better than the VNC viewer that homebrew installs with brew install tiger-vnc.</p>\n<p>YOU MUST RUN RSPEC WITH DISPLAY=:1 TO CONNECT TO THE Xvfb DISPLAY</p>\n<p>Otherwise, it will try to connect to the default display :0, which is not running.  rspec will fail, with playwright telling you that you do not have an X display running.</p>\n<p>In other words, start <code>rspec</code> with a command line like:</p>\n<pre><code>DISPLAY=:1 bundle exec rspec ...\n</code></pre>\n<p>AND DON'T FORGET TO CHANGE THE driven_by LINE IN THE SYSTEM TEST CONFIG TO USE :playwright_non_headless</p>\n<h3>Additional Notes</h3>\n<p>playwright and its browsers are installed using the post-create devcontainer.json script rather than the Dockerfile, in order to use the correct user for the installation.  That installation did not work when included in the Dockerfile instead of devcontainer.json .</p>\n<p>Although I include the code for non-headless browser, viewwed over VNC, I am not sure it is necessary to use non-headless, in that the playwright trace viewer is so effective.</p>\n<p>The instructions for changing system tests to use non-headless are in spec/rails_helper.rb</p>\n<p>If you do not want non-headless capability, just remove the extra port and simplify the <code>postCreateCommand</code> within <code>.devcontainer/devcontainer.json</code> as noted in the comments.  You could also remove the extra configuration in <code>spec/rails_helper.rb</code>, but that is harmless.</p>\n<p>If you do want to use a password, it must be set before calling the <code>bin/start_vnc_server_password</code> script, but if you do not you will get a message telling you how to do it.</p>\n<p>Not using a password is not as dangerous as it sounds, because VS Code will only map the port to localhost.</p>\n<p>Once you have started the XServer, you can connect to it using one of the VNC Viewers, at <code>localhost:5901</code></p>\n<p>If you do use <code>driven_by :playwright_non_headless</code>, be sure to include <code>DISPLAY=:1</code> before your rspec or xterm calls, like:</p>\n<p><code>DISPLAY=:1 rspec spec/system</code></p>\n<p>or, for an xterm into the container:</p>\n<p><code>DISPLAY=:1 xterm</code></p>\n<p>If you forget the <code>DISPLAY=:1</code> (or forget to start the XServer, or misspell DISPLAY), you will get an error from playwright:</p>\n<p><code>Looks like you launched a headed browser without having a XServer running.  Set either 'headless: true' or use 'xvfb-run &lt;your-playwright-app&gt;' before running Playwright.  &lt;3 Playwright Team</code></p>\n<h1>THE COMPLETE CODE FOR THIS PROJECT IS IN THE OTHER ANSWER</h1>\n", "tags": ["ruby-on-rails", "capybara", "playwright", "rspec-rails", "vnc"]}
{"id": "5905fb56-dde4-4342-a6d2-5aa3fd5ec613", "text": "Q: How to convert &quot;Buffer&lt;ArrayBufferLike&gt;&quot; to &quot;ArrayBuffer&quot; in TypeScript 5.7? A: <p>Probably a type error in the exact version of @types/node. Upgrade @types/node package instead of type casting or creating additional objects.</p>\n", "tags": ["typescript", "keepass", "typescript-5"]}
{"id": "b18c367c-57d6-4eca-912f-54ec2f4f962f", "text": "Q: SSH GitLab pull always asks for password A: <p>I've just solved this problem for my <a href=\"https://gitlab.com\" rel=\"nofollow noreferrer\">gitlab.com</a> repos: I've just followed the steps in their tutorial at <a href=\"https://docs.gitlab.com/ee/user/ssh.html\" rel=\"nofollow noreferrer\">Use SSH keys to communicate with GitLab</a>.</p>\n<p>There they explain how to create keys, but since mine already existed all I had to do was to follow the steps in the section <a href=\"https://docs.gitlab.com/ee/user/ssh.html#configure-ssh-to-point-to-a-different-directory\" rel=\"nofollow noreferrer\">Configure SSH to point to a different directory</a>. They're only:</p>\n<ol>\n<li><p>Type the commands</p>\n<pre class=\"lang-bash prettyprint-override\"><code>eval $(ssh-agent -s)\nssh-add &lt;full path to private SSH key&gt;\n</code></pre>\n<p>In Linux, the SSH keys are usually saved in the folder <code>~/.ssh/</code></p>\n</li>\n<li><p>Edit the <code>~/.ssh/config</code> file to have the lines</p>\n<pre class=\"lang-none prettyprint-override\"><code>Host gitlab.com\n   PreferredAuthentications publickey\n   IdentityFile &lt;full path to private SSH key&gt;\n</code></pre>\n</li>\n</ol>\n", "tags": ["git", "ssh", "gitlab"]}
{"id": "0eaedb00-cbb5-4f9f-88ec-bfb59aa47151", "text": "Q: Least matches for each player to play with every other A: <p><strong>Executive summary:</strong></p>\n\n<ul>\n<li><p>In spite of its similarity to the NP-complete minimum set cover problem, this question is far from intractable. In particular -- and quite unlike minimum set cover -- we know a non-trivial best possible answer in advance.</p></li>\n<li><p>That answer is the number of teams divided by 2 (plus 1 when the N of teams is odd). We can never do better than that.</p></li>\n<li><p>Because of the structure of the problem, there are <strong>many</strong> acceptable solutions that achieve the best possible answer. You can stumble across them using a basic randomized greedy algorithm. As the N of teams grows large, your first random attempt is almost always successful.</p></li>\n<li><p>This approach is fast even for large numbers of teams (for example, just a couple of seconds for 1000 teams).</p></li>\n</ul>\n\n<p><strong>Details:</strong></p>\n\n<p>You can use the formula for k-combinations to determine the number of teams required so that every player is paired with every other player (with k = 2).</p>\n\n<pre><code>n_teams = n! / ( (n - k)! k! )\n\nn     n_teams\n--    --------\n4     6\n5     10\n6     15\n7     21\n8     28\n9     36\n10    45\n11    55      # n_teams always equals the sum of values in previous row\n</code></pre>\n\n<p>What about the minimum number of matches? I think it's simply n_teams divided by 2 (with some padding to handle an odd number of teams).</p>\n\n<pre><code>min_n_matches = (n_teams + (n_teams % 2)) / 2\n</code></pre>\n\n<p>I don't have a rigorous proof for this, but the intuition seems sound. Each time you add a new player, you can think of that as an additional <strong>constraint</strong>: you've just added one more player who cannot appear on both sides of a given match. At the same time, that new player generates a bunch of new team combinations. Those new teams are like <strong>anti-constraints</strong>: their presence makes it easier to form valid matches.</p>\n\n<p>As you can see from the formula and data table above, the constraints (<code>n</code>) grow in linear fashion, but the anti-constraints (<code>n_teams</code>) grow much faster.</p>\n\n<p>If that's true, you don't need a smart algorithm to solve the problem: <strong>the greediest, most brain-dead algorithm will work fine</strong>. Match the teams randomly (but validly), and if your first attempt fails, just try again. As the number of teams grows larger, you'll rarely fail on the first attempt.</p>\n\n<p>There might be a better way to implement that idea, but here's an illustration that generates the teams and matches and confirms the assertions implied above.</p>\n\n<pre><code>import sys\nimport itertools\nimport random\n\ndef main():\n    maxN = int(sys.argv[1])\n    for n in range(4, maxN + 1):\n        run_scenario(n)\n\ndef run_scenario(n):\n    # Takes n of players.\n    # Generates matches and confirms our expectations.\n    k = 2\n    players = list(range(1, n + 1))\n    teams   = list(set(t) for t in itertools.combinations(players, k))\n\n    # Create the matches, and count how many attempts are needed.\n    n_calls = 0\n    matches = None\n    while matches is None:\n        matches = create_matches(teams)\n        n_calls += 1\n\n    # Print some info.\n    print dict(\n        n       = n,\n        teams   = len(teams),\n        matches = len(matches),\n        n_calls = n_calls,\n    )\n\n    # Confirm expected N of matches and that all matches are valid.\n    T = len(teams)\n    assert len(matches) == (T + (T % 2)) / 2\n    for t1, t2 in matches:\n        assert t1 &amp; t2 == set()\n\ndef create_matches(teams):\n    # Get a shuffled copy of the list of teams.\n    ts = list(teams)\n    random.shuffle(ts)\n\n    # Create the matches, greedily.\n    matches = []\n    while ts:\n        # Grab the last team and the first valid opponent.\n        t1 = ts.pop()\n        t2 = get_opponent(t1, ts)\n        # If we did not get a valid opponent and if there are still\n        # teams remaining, the greedy matching failed.\n        # Otherwise, we must be dealing with an odd N of teams.\n        # In that case, pair up the last team with any valid opponent.\n        if t2 is None:\n            if ts: return None\n            else:  t2 = get_opponent(t1, list(teams))\n        matches.append((t1, t2))\n\n    return matches\n\ndef get_opponent(t1, ts):\n    # Takes a team and a list of teams.\n    # Search list (from the end) until it finds a valid opponent.\n    # Removes opponent from list and returns it.\n    for i in xrange(len(ts) - 1, -1, -1):\n        if not t1 &amp; ts[i]:\n            return ts.pop(i)\n    return None\n\nmain()\n</code></pre>\n\n<p>A sample of output. Notice how the number of calls very quickly tends toward 1.</p>\n\n<pre><code>&gt; python volleyball_matches.py 100\n{'matches': 3, 'n_calls': 1, 'teams': 6, 'n': 4}\n{'matches': 5, 'n_calls': 7, 'teams': 10, 'n': 5}\n{'matches': 8, 'n_calls': 1, 'teams': 15, 'n': 6}\n{'matches': 11, 'n_calls': 1, 'teams': 21, 'n': 7}\n{'matches': 14, 'n_calls': 4, 'teams': 28, 'n': 8}\n{'matches': 18, 'n_calls': 1, 'teams': 36, 'n': 9}\n{'matches': 23, 'n_calls': 1, 'teams': 45, 'n': 10}\n{'matches': 28, 'n_calls': 1, 'teams': 55, 'n': 11}\n{'matches': 33, 'n_calls': 1, 'teams': 66, 'n': 12}\n...\n{'matches': 2186, 'n_calls': 1, 'teams': 4371, 'n': 94}\n{'matches': 2233, 'n_calls': 1, 'teams': 4465, 'n': 95}\n{'matches': 2280, 'n_calls': 1, 'teams': 4560, 'n': 96}\n{'matches': 2328, 'n_calls': 1, 'teams': 4656, 'n': 97}\n{'matches': 2377, 'n_calls': 1, 'teams': 4753, 'n': 98}\n{'matches': 2426, 'n_calls': 1, 'teams': 4851, 'n': 99}\n{'matches': 2475, 'n_calls': 1, 'teams': 4950, 'n': 100}\n</code></pre>\n", "tags": ["algorithm", "language-agnostic", "combinations"]}
