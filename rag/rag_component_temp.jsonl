{"id": "38b689c0-9270-4eaa-8bbe-de929c8c0c6c", "text": "Q: ExecuteInterpolatedSql with a WHERE IN Int[] statement A: <p>The one way:</p>\n<pre class=\"lang-cs prettyprint-override\"><code>public static string SafeINStatement(ref int paramIndex, ICollection values)\n{\n    var begin = paramIndex;\n    paramIndex += values.Count;\n    return string.Join(&quot;,&quot;, Enumerable.Range(begin, values.Count)\n        .Select(num =&gt; $&quot;{{{num}}}&quot;));\n}\n\n// ===================\nvar value = &quot;example&quot;;\nvar integers = new List&lt;int&gt; { 100, 404, 777 };\nvar pindex = 0;\nvar query = \n  @$&quot;DELETE FROM Table1\n  WHERE Type = {{{pindex++}}}\n  AND CAST(SUBSTRING(Value, 5, 7) AS INTEGER) IN ({SafeINStatement(ref pindex, integers)})&quot;;\n\nawait _signInDbContext.Database.ExecuteSqlRawAsync(query, [value, .. integers]);\n</code></pre>\n<hr />\n<p>The two way:</p>\n<pre class=\"lang-cs prettyprint-override\"><code>public static async Task&lt;int&gt; ExecuteSqlInterpolatedWithInStatementAsync(this DatabaseFacade database, FormattableString sql)\n{\n    var rawSqlFormat = sql.Format;\n    var args = sql.GetArguments();\n    var phList = new List&lt;object&gt;();\n    var sqlArgs = new List&lt;object&gt;();\n    var pIndex = 0;\n    for (var i = 0; i &lt; args.Length; i++)\n    {\n        if (args[i] is not string and IEnumerable list)\n        {\n            var collPh = new List&lt;string&gt;();\n            foreach (var arg in list)\n            {\n                collPh.Add($&quot;{{{pIndex++}}}&quot;);\n                sqlArgs.Add(arg);\n            }\n\n            phList.Add(string.Join(&quot;,&quot;, collPh));\n        }\n        else\n        {\n            phList.Add($&quot;{{{pIndex++}}}&quot;);\n            sqlArgs.Add(args[i]);\n        }\n    }\n\n    rawSqlFormat= string.Format(rawSqlFormat, phList.ToArray());\n    \n    return await database.ExecuteSqlRawAsync(rawSqlFormat, sqlArgs.ToArray());\n}\n\n// ===================\nvar value = &quot;example&quot;;\nvar integers = new List&lt;int&gt; { 100, 404, 777 };\nFormattableString query = \n  @$&quot;DELETE FROM Table1\n  WHERE Type = {value}\n  AND CAST(SUBSTRING(Value, 5, 7) AS INTEGER) IN ({integers})&quot;;\n\nawait _signInDbContext.Database.ExecuteSqlInterpolatedWithInStatementAsync(query);\n</code></pre>\n", "tags": ["c#", "sql-server", "entity-framework-core"]}
{"id": "b487f4df-43c3-46ff-b2b7-6918c40b282c", "text": "Q: How to update an entity using it&#39;s foreign key in Prisma? A: <ul>\n<li><p><strong><code>.update()</code></strong> \u2192 updates <strong>one record</strong>, so the <code>where</code> must use a field that has <strong><code>@unique</code></strong> (like <code>id</code>, email, etc.).</p>\n</li>\n<li><p><strong><code>.updateMany()</code></strong> \u2192 updates <strong>multiple records</strong>, so the <code>where</code> can use <strong>any field</strong>, whether it has <strong><code>@unique</code></strong> or not.</p>\n</li>\n</ul>\n<p>Summary:<br />\nupdate \u2192 requires <code>@unique</code> field<br />\nupdateMany \u2192 does not require <code>@unique</code> field/ all fields</p>\n", "tags": ["javascript", "node.js", "express", "prisma", "prisma2"]}
{"id": "116c6442-7bf1-4e7a-930b-659705aea49b", "text": "Q: Best sites to gather cheat-sheets/notes A: <p><a href=\"https://devdocs.io\" rel=\"nofollow noreferrer\">https://devdocs.io</a> aggregates documentation from hundreds of sources (programming languages references, open standards, libraries and frameworks, cli tools, and more) and presents it in uniform way. It fits the &quot;cheat sheet&quot; aspect of author's question as long as the original documentation does, maybe less so for examples/snippets.</p>\n", "tags": ["python", "c++", "git", "machine-learning", "dsa"]}
{"id": "0406769a-0348-4f60-a4fa-e4b84cbff78b", "text": "Q: how to solve Kernel configuration is invalid issues A: <h1>Re Install Linux Headers</h1>\n<p>You need the following access:</p>\n<ul>\n<li>sudo</li>\n<li>terminal (bash in this case)</li>\n</ul>\n<pre><code>sudo apt update\nsudo apt install --reinstall linux-headers-$(uname -r)\nsudo reboot\n</code></pre>\n<pre><code># for debugging\ncat /var/log/kern.log\n</code></pre>\n", "tags": ["linux-kernel", "linux-device-driver"]}
{"id": "0d3ff551-949e-47af-b1ba-15ab4536b836", "text": "Q: Add my own type to PolymorphicTypeValidator with spring security 7.0.0 and Jackon 3? A: <p>After a long night, here's what I've figured out.</p>\n<p>Indeed, the class that extends `org.springframework.security.core.userdetails.User` works because it extends a class that the JSONMapper is authorized to deserialize and the rule of the <a href=\"https://javadoc.io/doc/tools.jackson.core/jackson-databind/latest/tools.jackson.databind/tools/jackson/databind/jsontype/PolymorphicTypeValidator.html\" rel=\"nofollow noreferrer\">PolymorphicTypeValidator</a> is to authorize all spring security package classes ans all classes that implement those spring classes !</p>\n<p>The implemented solution isn't good because the JSONMapper isn't global... and therefore serves no purpose where I've placed it.</p>\n<p>It needs to be instantiated in the right place (or a solution found to make it global... but I don't think that's the best idea).</p>\n<p>So my problem arises when it deserializes the objects stored in the attribute column of the `oauth2_authorization` table. He wants to retrieve the main object, and this object is the following:</p>\n<pre><code>&quot;principal&quot;:\n        {\n            &quot;@class&quot;: &quot;com.authorization.server.security.CustomUser&quot;,\n            &quot;accountNonExpired&quot;: true,\n            &quot;accountNonLocked&quot;: true,\n            &quot;authorities&quot;:\n            [\n                &quot;java.util.Collections$UnmodifiableSet&quot;,\n                [\n                    {\n                        &quot;@class&quot;: &quot;org.springframework.security.core.authority.SimpleGrantedAuthority&quot;,\n                        &quot;authority&quot;: &quot;USER&quot;\n                    }\n                ]\n            ],\n            &quot;credentialsNonExpired&quot;: true,\n            &quot;enabled&quot;: true,\n            &quot;password&quot;: null,\n            &quot;username&quot;: &quot;user&quot;\n        }\n    }\n</code></pre>\n<p>What's needed is for the JsonMapper associated with my JdbcOAuth2AuthorizationService bean to understand that it has the right to deserialize an object of type &quot;com.authorization.server.security.CustomUser&quot;.</p>\n<p>To do this, I create a clean JsonMapper as in my initial implementation:</p>\n<pre><code>@Bean\npublic JsonMapper securityJsonMapper() {\n    ClassLoader loader = getClass().getClassLoader();\n    BasicPolymorphicTypeValidator.Builder typeValidatorBuilder = BasicPolymorphicTypeValidator.builder()\n    // Explicitly allow the main user of type customUser\n    .allowIfSubType(com.authorization.server.security.CustomUser.class);\n    return JsonMapper.builder()\n    // Add all Spring Security modules + our validator builder\n    .addModules(SecurityJacksonModules.getModules(loader, typeValidatorBuilder))\n    .build();\n}\n</code></pre>\n<p>But this time I'm creating my JdbcOAuth2AuthorizationService bean with the constructor that allows passing a JsonMapper:</p>\n<pre><code>@Bean\npublic JdbcOAuth2AuthorizationService jdbcOAuth2AuthorizationService(\n        JdbcOperations jdbcOperations,\n        RegisteredClientRepository registeredClientRepository,\n        JsonMapper securityJsonMapper) {\n</code></pre>\n<p>and I'm doing this:</p>\n<pre><code>        service.setAuthorizationRowMapper(\n                new JdbcOAuth2AuthorizationService.JsonMapperOAuth2AuthorizationRowMapper(registeredClientRepository,\n                        securityJsonMapper));\n\n        service.setAuthorizationParametersMapper(\n                new JdbcOAuth2AuthorizationService.JsonMapperOAuth2AuthorizationParametersMapper(securityJsonMapper));\n</code></pre>\n<p>Jackson3 changes a lot of things... and I hope this night's work will be useful to others.</p>\n<p>Don't hesitate to ask questions in comment if necessary !</p>\n", "tags": ["spring", "spring-security", "spring-security-oauth2", "jackson-3"]}
{"id": "fedd82be-96d8-422f-97bb-822d22597a90", "text": "Q: Redirect doesn\u2019t fire reliably after logout/login with StreamProvider user profile A: <p>Did you try to use the refreshListenable param at GoRouter with your userProvider ?<br />\nI don't know if it'll work with a Stream.</p>\n<pre><code>  return GoRouter(\n    refreshListenable: user(ref),\n</code></pre>\n", "tags": ["flutter", "firebase", "dart", "gorouter"]}
{"id": "cc7415ce-dc21-49d2-828a-7f54c959a390", "text": "Q: Avoiding templates when working with different std::vectors A: <p>You can use <a href=\"https://en.cppreference.com/w/cpp/utility/variant.html\" rel=\"nofollow noreferrer\"><code>std::variant</code></a> and define a member in class <code>C</code> of the following type:</p>\n<pre><code>std::vector&lt;std::variant&lt;A,B&gt;&gt;\n</code></pre>\n<p>Then you can use the <a href=\"https://en.cppreference.com/w/cpp/utility/variant/visit2.html\" rel=\"nofollow noreferrer\"><code>std::visit</code></a> to access elements.</p>\n", "tags": ["c++", "templates", "stdvector", "pointer-arithmetic"]}
