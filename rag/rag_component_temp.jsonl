{"id": "d970978d-1cb9-4117-9a3b-b4e39717f393", "text": "Q: How can I execute PHP code from the command line? A: <p>The best console for executing code is the xdebug console in Phpstorm. Because it is integrated into the IDE and contains such basic features as syntax highlighting/checking, autocompletion, quick documentation, etc. To access it, you need to start debugging any PHP file:</p>\n<p><a href=\"https://i.sstatic.net/nrLmMDPN.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/nrLmMDPN.gif\" alt=\"enter image description here\" /></a></p>\n", "tags": ["php", "function", "shell", "command-line"]}
{"id": "676bafb4-ec32-4abf-b1dd-cf366697b5ef", "text": "Q: How can I format a number with commas as thousands separators? A: <p>I used the idea from <a href=\"https://stackoverflow.com/questions/2901102/how-can-i-format-a-number-with-commas-as-thousands-separators/2901136#2901136\">Kerry's answer</a>, but I simplified it since I was just looking for something simple for my specific purpose. Here is what I have:</p>\n<pre><code>function numberWithCommas(x) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, &quot;,&quot;);\n}\n</code></pre>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"true\" data-console=\"true\" data-babel=\"false\" data-babel-preset-react=\"false\" data-babel-preset-ts=\"false\">\n<div class=\"snippet-code snippet-currently-hidden\">\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>function numberWithCommas(x) {\n    return x.toString().replace(/\\B(?&lt;!\\.\\d*)(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\nfunction test(x, expect) {\n    const result = numberWithCommas(x);\n    const pass = result === expect;\n    console.log(`${pass ? \"\u2713\" : \"ERROR ====&gt;\"} ${x} =&gt; ${result}`);\n    return pass;\n}\n\nlet failures = 0;\nfailures += !test(0,        \"0\");\nfailures += !test(100,      \"100\");\nfailures += !test(1000,     \"1,000\");\nfailures += !test(10000,    \"10,000\");\nfailures += !test(100000,   \"100,000\");\nfailures += !test(1000000,  \"1,000,000\");\nfailures += !test(10000000, \"10,000,000\");\nif (failures) {\n    console.log(`${failures} test(s) failed`);\n} else {\n    console.log(\"All tests passed\");\n}</code></pre>\n<pre class=\"snippet-code-css lang-css prettyprint-override\"><code>.as-console-wrapper {\n    max-height: 100% !important;\n}</code></pre>\n</div>\n</div>\n</p>\n<hr />\n<p>The regex uses two lookahead assertions:</p>\n<ul>\n<li>a positive one to look for any point in the string that has a multiple of 3 digits in a row after it,</li>\n<li>a negative assertion to make sure that point only has exactly a multiple of 3 digits. The replacement expression puts a comma there.</li>\n</ul>\n<p>For example, if you pass it <code>123456789.01</code>, the positive assertion will match every spot to the left of the 7 (since <code>789</code> is a multiple of 3 digits, <code>678</code> is a multiple of 3 digits, <code>567</code>, etc.).</p>\n<p>The negative assertion checks that the multiple of 3 digits does not have any digits after it. <code>789</code> has a period after it so it is exactly a multiple of 3 digits, so a comma goes there. <code>678</code> is a multiple of 3 digits, but it has a <code>9</code> after it, so those 3 digits are part of a group of 4, and a comma does not go there. Similarly for <code>567</code>.</p>\n<p><code>456789</code> is 6 digits, which is a multiple of 3, so a comma goes before that. <code>345678</code> is a multiple of 3, but it has a <code>9</code> after it, so no comma goes there. And so on. The <code>\\B</code> keeps the regex from putting a comma at the beginning of the string.</p>\n<p><a href=\"https://stackoverflow.com/questions/2901102/how-can-i-format-a-number-with-commas-as-thousands-separators/2901136#comment14009614_2901298\">neu-rah mentioned</a> that this function adds commas in undesirable places if there are more than 3 digits after the decimal point. If this is a problem, you can use this function:</p>\n<pre><code>function numberWithCommas(x) {\n    var parts = x.toString().split(&quot;.&quot;);\n    parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, &quot;,&quot;);\n    return parts.join(&quot;.&quot;);\n}\n</code></pre>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"true\" data-console=\"true\" data-babel=\"false\" data-babel-preset-react=\"false\" data-babel-preset-ts=\"false\">\n<div class=\"snippet-code snippet-currently-hidden\">\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>function numberWithCommas(x) {\n    var parts = x.toString().split(\".\");\n    parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n    return parts.join(\".\");\n}\n\nfunction test(x, expect) {\n    const result = numberWithCommas(x);\n    const pass = result === expect;\n    console.log(`${pass ? \"\u2713\" : \"ERROR ====&gt;\"} ${x} =&gt; ${result}`);\n    return pass;\n}\n\nlet failures = 0;\nfailures += !test(0              , \"0\");\nfailures += !test(0.123456       , \"0.123456\");\nfailures += !test(100            , \"100\");\nfailures += !test(100.123456     , \"100.123456\");\nfailures += !test(1000           , \"1,000\");\nfailures += !test(1000.123456    , \"1,000.123456\");\nfailures += !test(10000          , \"10,000\");\nfailures += !test(10000.123456   , \"10,000.123456\");\nfailures += !test(100000         , \"100,000\");\nfailures += !test(100000.123456  , \"100,000.123456\");\nfailures += !test(1000000        , \"1,000,000\");\nfailures += !test(1000000.123456 , \"1,000,000.123456\");\nfailures += !test(10000000       , \"10,000,000\");\nfailures += !test(10000000.123456, \"10,000,000.123456\");\nif (failures) {\n    console.log(`${failures} test(s) failed`);\n} else {\n    console.log(\"All tests passed\");\n}</code></pre>\n<pre class=\"snippet-code-css lang-css prettyprint-override\"><code>.as-console-wrapper {\n    max-height: 100% !important;\n}</code></pre>\n</div>\n</div>\n</p>\n<p><a href=\"https://stackoverflow.com/questions/2901102/how-can-i-format-a-number-with-commas-as-thousands-separators/2901136#comment106989235_2901298\">T.J. Crowder pointed out</a> that now that JavaScript has lookbehind (<a href=\"https://caniuse.com/#feat=js-regexp-lookbehind\" rel=\"nofollow noreferrer\">support info</a>), it can be solved in the regular expression itself:</p>\n<pre><code>function numberWithCommas(x) {\n    return x.toString().replace(/\\B(?&lt;!\\.\\d*)(?=(\\d{3})+(?!\\d))/g, &quot;,&quot;);\n}\n</code></pre>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"true\" data-console=\"true\" data-babel=\"false\" data-babel-preset-react=\"false\" data-babel-preset-ts=\"false\">\n<div class=\"snippet-code snippet-currently-hidden\">\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>function numberWithCommas(x) {\n    return x.toString().replace(/\\B(?&lt;!\\.\\d*)(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\nfunction test(x, expect) {\n    const result = numberWithCommas(x);\n    const pass = result === expect;\n    console.log(`${pass ? \"\u2713\" : \"ERROR ====&gt;\"} ${x} =&gt; ${result}`);\n    return pass;\n}\n\nlet failures = 0;\nfailures += !test(0,               \"0\");\nfailures += !test(0.123456,        \"0.123456\");\nfailures += !test(100,             \"100\");\nfailures += !test(100.123456,      \"100.123456\");\nfailures += !test(1000,            \"1,000\");\nfailures += !test(1000.123456,     \"1,000.123456\");\nfailures += !test(10000,           \"10,000\");\nfailures += !test(10000.123456,    \"10,000.123456\");\nfailures += !test(100000,          \"100,000\");\nfailures += !test(100000.123456,   \"100,000.123456\");\nfailures += !test(1000000,         \"1,000,000\");\nfailures += !test(1000000.123456,  \"1,000,000.123456\");\nfailures += !test(10000000,        \"10,000,000\");\nfailures += !test(10000000.123456, \"10,000,000.123456\");\nif (failures) {\n    console.log(`${failures} test(s) failed`);\n} else {\n    console.log(\"All tests passed\");\n}</code></pre>\n<pre class=\"snippet-code-css lang-css prettyprint-override\"><code>.as-console-wrapper {\n    max-height: 100% !important;\n}</code></pre>\n</div>\n</div>\n</p>\n<p><code>(?&lt;!\\.\\d*)</code> is a negative lookbehind that says the match can't be preceded by a <code>.</code> followed by zero or more digits. The negative lookbehind is faster than the <code>split</code> and <code>join</code> solution (<a href=\"http://jsben.ch/umq99\" rel=\"nofollow noreferrer\">comparison</a>), at least in <a href=\"https://en.wikipedia.org/wiki/V8_%28JavaScript_engine%29\" rel=\"nofollow noreferrer\">V8</a>.</p>\n", "tags": ["javascript", "formatting", "numbers"]}
{"id": "fbdeabae-8bc7-49ba-9c20-58c5e111ecaf", "text": "Q: Sudden Query Execution Delay - MongoDB flex plan A: <p>sudden query delays are expected on MongoDB Atlas FLEX because it\u2019s a shared, low-cost cluster with limited resources. Performance can fluctuate due to temporary load from other tenants, and you cannot configure memory or storage on FLEX. To improve query speed, you\u2019ll need to optimize indexes, query patterns, or consider upgrading to a dedicated M-series cluster</p>\n", "tags": ["mongodb", "mongodb-query"]}
{"id": "fd0bcc2f-4d08-4d53-a9c0-e4885304cfe0", "text": "Q: Adding files to install into a Yocto recipe with eSDK A: <p>Files in <code>SRC_URI</code> are expected in the recipe's files directory, not the source tree. <code>devtool modify</code> only links the source repo it doesn't change where bitbake looks for recipe files.</p>\n<p><strong>If the .service file is in the source repo, install from ${S}:</strong></p>\n<pre><code>do_install:append() {\n    install -d ${D}${systemd_system_unitdir}\n    install -m 0644 ${S}/myapp.service ${D}${systemd_system_unitdir}/\n}\n</code></pre>\n<p>Don't add it to SRC_URI\u2014it's already in the source.</p>\n<p><strong>If you want it separate from the source, put it in the recipe layer:</strong></p>\n<pre><code>recipes-app/myapp/\n\u251c\u2500\u2500 myapp_%.bbappend\n\u2514\u2500\u2500 files/\n    \u2514\u2500\u2500 myapp.service\n</code></pre>\n<pre><code>FILESEXTRAPATHS:prepend := &quot;${THISDIR}/files:&quot;\nSRC_URI += &quot;file://myapp.service&quot;\n</code></pre>\n<p>Then it installs from ${WORKDIR} as usual.</p>\n", "tags": ["yocto", "yocto-recipe"]}
{"id": "5dae9ba2-8712-499d-8e70-98e3d4179687", "text": "Q: Process does not terminate in Spring Environment and Spring boot application is not responding A: <p>You've answered your own question really, but here is some explanation.</p>\n<p>Any sub-process which reads from the STDIN may be starved of input (and run indefinitely) if you don't explicitly mark the end of STDIN by the use of <code>process.getOutputStream().close()</code>. It is easy to demonstrate by refactoring your call as helper method:</p>\n<pre><code>static int start(String[] cmd) throws IOException, InterruptedException {\n    Process process = new ProcessBuilder(cmd).redirectErrorStream(true).start();\n\n    try(InputStream so = process.getInputStream()) {\n        so.transferTo(System.out);\n        // OR save to file:\n        // Files.copy(so, Path.of(&quot;start.log&quot;));\n    }\n\n    // Await process exit\n    int rc = process.waitFor();\n    System.out.println(&quot;Exit PID &quot;+process.pid()+&quot; CODE &quot;+rc +' '+(rc == 0 ? &quot;OK&quot;:&quot;**** ERROR ****&quot;)+&quot; command:&quot;+Arrays.toString(cmd));\n    return rc;\n}\n</code></pre>\n<p>And call with:</p>\n<pre><code>String [] cmd = {  &quot;ffmpeg&quot;, &quot;-y&quot;, &quot;-loop&quot;, &quot;1&quot;, \n        &quot;-i&quot;, tempImage.getAbsolutePath(), &quot;-i&quot;, tempAudio.getAbsolutePath(),\n        &quot;-c:v&quot;, &quot;libx264&quot;, &quot;-tune&quot;, &quot;stillimage&quot;, &quot;-c:a&quot;, &quot;aac&quot;,\n        &quot;-b:a&quot;, &quot;192k&quot;, &quot;-pix_fmt&quot;, &quot;yuv420p&quot;, &quot;-shortest&quot;, tempVideo.getAbsolutePath()\n};\nint exitCode = start(cmd);\n</code></pre>\n<p>or use try these <code>start</code> method calls. Each will stall as the sub-process blocks reading STDIN:</p>\n<pre><code>start(new String[]{&quot;cmd.exe&quot;, &quot;/c&quot;, &quot;findstr h&quot;}); // WINDOWS\nstart(new String[]{&quot;grep&quot;, &quot;h&quot;});                  // GNU/Linux\n</code></pre>\n<p>The easy fix is to close stdin. After adjusting <code>start()</code> to allow caller to pass in STDIN, the above <code>findstr</code>/<code>grep</code> calls will work fine:</p>\n<pre><code>public static void main(String... cmd) throws IOException, InterruptedException {\n    start(cmd, null);\n    // OR try start(cmd, &quot;hello%nworld%n&quot;.formatted().getBytes());\n}\nprivate static int start(String[] cmd, byte[] stdin) throws IOException, InterruptedException {\n    Process process = new ProcessBuilder(cmd).redirectErrorStream(true).start();\n\n    // Use current thread to send STDIN to the process (if provided)\n    // !!! NOTE !!! This only works for small stdin,\n    // you must use background thread here if stdin exceeds this OS JVM buffer size\n    try(OutputStream os = process.getOutputStream()) {\n        if (stdin != null) {\n            os.write(stdin);\n        }\n    }\n\n    try(InputStream so = process.getInputStream()) {\n        so.transferTo(System.out);\n        // OR capture to file:\n        // Files.copy(so, Path.of(&quot;start.log&quot;));\n    }\n\n    // Await process exit\n    int rc = process.waitFor();\n    System.out.println(&quot;Exit PID &quot;+process.pid()+&quot; CODE &quot;+rc +' '+(rc == 0 ? &quot;OK&quot;:&quot;**** ERROR ****&quot;)+&quot; command:&quot;+Arrays.toString(cmd));\n    return rc;\n}\n</code></pre>\n<p>Note the above is simplified example. There are limited OS buffers for sub-process STDIN, STDOUT and STDERR and it is <strong>essential</strong> to use separate threads for each reader and writer used for sub-process I/O to avoid risk of blocking the sub-process, or use <code>.inheritIO()</code>.</p>\n", "tags": ["java", "spring-boot", "ffmpeg", "process", "processbuilder"]}
{"id": "3f12fdb2-6fd7-4db8-815b-a59d868d9253", "text": "Q: How can I increase JaCoCo coverage by excluding files A: <p>JaCoCo exclusions in <code>prepare-agent</code> skip instrumentation, but excluded classes still appear in reports. That's by design JaCoCo reports on what it finds in your compiled classes, not just what it instrumented.</p>\n<p><strong>To exclude from JaCoCo report too, add excludes to the report execution:</strong></p>\n<pre><code>&lt;execution&gt;\n    &lt;id&gt;report&lt;/id&gt;\n    &lt;goals&gt;\n        &lt;goal&gt;report&lt;/goal&gt;\n    &lt;/goals&gt;\n    &lt;configuration&gt;\n        &lt;excludes&gt;\n            &lt;exclude&gt;**/some/excluded/dirs/**/*&lt;/exclude&gt;\n        &lt;/excludes&gt;\n    &lt;/configuration&gt;\n&lt;/execution&gt;\n</code></pre>\n<p><strong>For SonarQube, use separate exclusions:</strong></p>\n<pre><code>&lt;properties&gt;\n    &lt;sonar.exclusions&gt;\n        **/com/company/dto/**/*,\n        **/com/company/config/**/*\n    &lt;/sonar.exclusions&gt;\n&lt;/properties&gt;\n</code></pre>\n<p>JaCoCo exclusions and Sonar exclusions are independent Sonar uses JaCoCo's report data but applies its own exclusion filters on top. If you only care about SonarQube coverage numbers, <code>sonar.exclusions</code> is the simpler fix.</p>\n", "tags": ["java", "jacoco"]}
{"id": "0fa8cfce-efae-456c-ac4e-5f63105d4a15", "text": "Q: How can I auto-elevate my batch file, so that it requests from UAC administrator rights if required? A: <p>I edited <a href=\"https://stackoverflow.com/a/12264592\">original Matt solution</a>:</p>\n<pre><code>@echo off &amp; cd /d &quot;%~dp0&quot;\nchcp 1251\nREM :::::::::::::::::::::::::::::::::::::::::\nREM Elevate.cmd - Version 10 custom\nREM Automatically check &amp; get admin rights\nREM see &quot;https://stackoverflow.com/a/79585058&quot; for description\nREM :::::::::::::::::::::::::::::::::::::::::\n \n ECHO.\n ECHO =============================\n ECHO Running Admin shell\n ECHO =============================\n ECHO.\n\n set &quot;batchPath=%~dpnx0&quot;\n rem this works also from cmd shell, other than %~0\n for %%k in (%0) do set batchName=%%~nk\n set &quot;vbsGetPrivileges=%temp%\\OEgetPriv_%batchName%.vbs&quot;\n setlocal EnableDelayedExpansion\n\n:checkPrivileges\n  whoami /groups /nh | find &quot;S-1-16-12288&quot; &gt; nul\n  if not '%errorlevel%'=='0' goto getPrivileges\n  net session 1&gt;nul 2&gt;NUL\n  if '%errorlevel%'=='0' goto gotPrivileges\n  if '%1'=='ELEV' goto gotPrivileges\n\n:getPrivileges\n  ECHO **************************************\n  ECHO Invoking UAC for Privilege Escalation\n  ECHO **************************************\n\n  ECHO args = &quot;ELEV &quot;&gt;&quot;%vbsGetPrivileges%&quot;\n  ECHO For Each strArg in WScript.Arguments&gt;&gt;&quot;%vbsGetPrivileges%&quot;\n  ECHO args = args ^&amp; strArg ^&amp; &quot; &quot;&gt;&gt;&quot;%vbsGetPrivileges%&quot;\n  ECHO Next&gt;&gt;&quot;%vbsGetPrivileges%&quot;\n  ECHO args = &quot;/c &quot;&quot;&quot; + &quot;!batchPath!&quot; + &quot;&quot;&quot; &quot; + args&gt;&gt;&quot;%vbsGetPrivileges%&quot;\n  ECHO CreateObject(&quot;Shell.Application&quot;).ShellExecute &quot;%SystemRoot%\\System32\\cmd.exe&quot;, args, &quot;&quot;, &quot;runas&quot;, 1 &gt;&gt;&quot;%vbsGetPrivileges%&quot;\n  ECHO CreateObject(&quot;Scripting.FileSystemObject&quot;).DeleteFile &quot;%vbsGetPrivileges%&quot;&gt;&gt;&quot;%vbsGetPrivileges%&quot;\n\n &quot;%SystemRoot%\\System32\\WScript.exe&quot; &quot;%vbsGetPrivileges%&quot;\n exit /B\n\n:gotPrivileges\n endlocal\n\nREM :::::::::::::::::::::::::\nREM START\nREM :::::::::::::::::::::::::\nREM Run shell as admin - put your code below as you like\n</code></pre>\n<p>Firstly there was a problem with using the script in the middle of if/else statements because of comments with colons instead of REMs, they didn't work well and the script was crashing. I didn't try to rewrite it at the time and it was Matt who understood that this is because of colons which were to be replaced by REMs, I just reported the bug without the proper solution (it was somewhat working if you remove empty lines as I suggested but of course it was crunchy and imperfect). Also about the same time echo off didn't work if you don't put it at the top of the script (which I did and Matt did the same). Time passed, but I always continued to use the script. Now I wanted to rewrite the script fully because I actively use it with my bigger project (you can find it on my GitHub if you search for it), and we don't always agree with everything.</p>\n<p>The original script is large and uses a lot of technic. I always appreciate the short and understandble coding, each line should be there because of the clear reason. If there are a lot of variables which you don't have to use, or other things, the result is becoming too bulky. In the middle of simplification I fixed another bug - if you cancel UAC elevation, the script will remain in the temp folder, and will only be deleted upon successful elevation. It is no longer the case and I'm proud that I both found and fixed this bug. Now Matt may or may not agree with everything I said, but I probably will stick to my custom version to not force the design choices. For example original script uses shifts but I don't understand why you have to use it, I don't see the clear functional reason. I reduced the size of the script from 2178 to 1742 bytes, from 66 to 50 lines, made it more functional, and did a lot of testing and bugfixes.</p>\n<p>I use chcp to always support cyrillic, because original batch don't do it, but you may set any other chcp to support for example Latin special characters.</p>\n", "tags": ["windows", "batch-file", "uac", "windows-11", "elevated-privileges"]}
