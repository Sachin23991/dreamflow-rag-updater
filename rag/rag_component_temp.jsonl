{"id": "7d4712fe-1419-449e-9470-0bf5076d20a6", "text": "Q: Are they the &quot;same&quot;? A: <p>The problem setup explains:</p>\n<blockquote>\n<p>If a or b are nil (or null or None, depending on the language), the problem doesn't make sense so return false.</p>\n</blockquote>\n<p>The OP code responds properly in the [ ] case.\nBut it neglects to check whether None was passed in.</p>\n", "tags": ["python", "arrays"]}
{"id": "97c84b43-b396-46e6-a278-6fb70798166a", "text": "Q: Cannot Delete a Python Named Temporary File in Windows A: <p>The call <code>tempfile.NamedTemporaryFile</code> returns a <em>wrapper</em> around a file. In your case <code>temp_file</code>, which has been returned with the call, has attributes <code>name</code> (the file name) and <code>file</code> (the underlying system file). You can use either <code>temp_file</code> or <code>temp_file.file</code> for I/O operations. <strong>But nowhere in you code have you issued a call to <code>close</code> on the file.</strong> So when you go to remove the file you get the error you get.</p>\n<p>You should either code an explicit <code>temp_file.close()</code> (or <code>temp_file.file.close()</code>) or use a context manager:</p>\n<pre class=\"lang-py prettyprint-override\"><code>with tempfile.NamedTemporaryFile(mode=&quot;w+&quot;, newline=&quot;&quot;, suffix=&quot;.csv&quot;, delete=False) as temp_file:\n    with temp_file.file as file:\n        ...\n    # The file will be closed when we reach here\n</code></pre>\n<p>Also, when you use <code>tempfile.NamedTemporaryFile</code>, the file is already opened for you so you should not issue an explicit <code>open</code>.</p>\n", "tags": ["python", "windows", "temporary-files"]}
{"id": "a0ff3517-6547-46e5-9c73-0e1d6c2a784c", "text": "Q: docker-compose up hangs forever. How to debug? A: <p>Just try to reload your machine.</p>\n", "tags": ["docker", "docker-compose"]}
{"id": "a60f435f-ec31-4403-964b-3e3159dabc6f", "text": "Q: Generating and Optimizing Webp via Gulp A: <p>This is my option in 2021 year.</p>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\" data-babel-preset-react=\"false\" data-babel-preset-ts=\"false\">\n<div class=\"snippet-code\">\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>const {src, dest, parallel, series, watch} = require('gulp');\nconst imagemin = require('gulp-imagemin');\nconst webp = require('imagemin-webp');\nconst extReplace = require('gulp-ext-replace');\n\nconst exportWebP = () =&gt; {\n  return src(['./src/img/**/*.jpg', './src/img/**/*.png'], {base: 'src'})\n    .pipe(imagemin([\n      webp({\n        quality: 60,\n      })\n    ]))\n    .pipe(extReplace('.webp'))\n    .pipe(dest('./app/'))\n}\n\nwatch(['./src/img/**/*.jpg', './src/img/**/*.png'], exportWebP);\nexports.default = series(parallel(exportWebP));</code></pre>\n</div>\n</div>\n</p>\n", "tags": ["optimization", "gulp", "yeoman-generator", "webp"]}
{"id": "5d1f5e73-7683-4743-9a51-6706aae0e7cf", "text": "Q: how to write a svn hook script A: <p>Here is  a sample :</p>\n<p>After svn commit with special folder; build A <code>Jenkins</code> project.</p>\n<pre class=\"lang-bash prettyprint-override\"><code>&lt;#\n.SYNOPSIS\n    Automated Jenkins Build Trigger for SVN Hooks.\n\n.DESCRIPTION\n    This script is designed to be integrated with SVN (Subversion) post-commit hooks. \n    It analyzes the SVN revision, commit messages, and changed paths to automatically \n    trigger specific Jenkins jobs via the Jenkins Remote API.\n\n    Features:\n    - Trigger Jenkins jobs based on directory path mapping.\n    - Support for Commit Message commands: [ci skip], [build: projectName].\n    - Automatic detection of modified files using SVN XML logs.\n    - UTF-8 logging for both console and local log files.\n\n.PARAMETER PATH\n    The execution path provided by the SVN hook.\n.PARAMETER REVISION\n    The SVN revision number to analyze.\n.PARAMETER RESULTPATH\n    The physical path of the committed files in the repository.\n.PARAMETER projectName\n    (Optional) Force a specific Jenkins job name to build.\n\n.EXAMPLE\n    .\\autoJenkins.ps1 -REVISION &quot;413&quot; -RESULTPATH &quot;G:\\work\\SVN\\LifeHelper\\Program\\InterFace\\WebService&quot;\n#&gt;\n# \u6267\u884c\u547d\u4ee4\n# powershell.exe -command &quot;&amp; {start-process powershell.exe (([system.environment]::GetCommandLineArgs()|ForEach-Object -process { '\\&quot;{0}\\&quot;' -f $_ })[3..([system.environment]::GetCommandLineArgs().Length-1)])}&quot; &quot;-file&quot; &quot;G:\\work\\SVN\\LifeHelper\\autoJenkins.ps1&quot;\n\n# powershell  G:\\work\\SVN\\LifeHelper\\autoJenkins.ps1\n# PATH DEPTH MESSAGEFILE REVISION ERROR \n\nparam(\n    [string]$PATH,      # \u547d\u4ee4\u6267\u884c\u8def\u5f84\n    [string]$DEPTH,  # \u5bf9\u5e94 arg 1\n    [string]$MESSAGEFILE,    # \u5bf9\u5e94 arg 2\n    [string]$REVISION,    # \u5bf9\u5e94 arg 2\n    [string]$SVN_ERROR,    # \u5bf9\u5e94 arg 2\n    [string]$RESULTPATH,   # svn\u6587\u4ef6\u63d0\u4ea4\u8def\u5f84\n    [string]$projectName    # \u53d1\u5e03\u7684\u9879\u76ee\u540d\u79f0\n)\n\n[Console]::OutputEncoding = [System.Text.UTF8Encoding]::new()\n$OutputEncoding = [System.Text.UTF8Encoding]::new()\n\nWrite-Host &quot;$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss.fff') start script&quot;\nAdd-Content svn-hook.log &quot;$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss.fff') start script&quot;\n\n# Read-Host &quot;Press Enter to exit&quot;\n\n$svnPath = $env:svnPath;\nif ([string]::IsNullOrWhiteSpace($svnPath)) {\n       $svnPath=&quot;D:\\svn\\repo&quot;\n}\n\n\n$pathMap = @(\n    [PSCustomObject]@{\n        Path = &quot;\\Program\\InterFace\\WebService&quot;\n        JobName     = &quot;WebService&quot;\n    } \n)\n\n\n# Jenkins \u670d\u52a1\u5668\u5730\u5740\n$JENKINS_URL=&quot;http://192.168.1.100:8080&quot;\n\n$username = &quot;007&quot;\n# \u6ce8\u610f\uff1a\u5982\u679c\u662f Jenkins\uff0c\u8fd9\u91cc\u901a\u5e38\u586b API Token\uff0c\u800c\u4e0d\u662f\u767b\u5f55\u5bc6\u7801\n$password = &quot;xxx&quot; \n\nfunction Log {\n    param([string]$Message)\n    Write-Host &quot;$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss') $Message&quot;\n    Add-Content svn-hook.log &quot;$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss') $Message&quot;\n}\nLog &quot;PATH: $PATH&quot;\nLog &quot;DEPTH: $DEPTH&quot;\nLog &quot;MESSAGEFILE: $MESSAGEFILE&quot;\nLog &quot;REVISION: $REVISION&quot;\nLog &quot;SVN_ERROR: $SVN_ERROR&quot;\nLog &quot;RESULTPATH: $RESULTPATH&quot;\n\n$script:listProjectName = @()\n# Read-Host &quot;Press Enter to exit&quot;\n# \u53d1\u9001 Jenkins \u6784\u5efa\u8bf7\u6c42\nfunction BuildProject {\n    param(        \n        [string]$projectName,\n        [string]$hookPath = &quot;&quot;\n    )\n    \n     # \u68c0\u67e5\u662f\u5426\u5b58\u5728\n    if ($script:listProjectName -contains $ProjectName) {\n        Log &quot;ignore project: $ProjectName&quot;\n        return\n    }\n\n    # \u6dfb\u52a0\u5230\u811a\u672c\u4f5c\u7528\u57df\u7684\u53d8\u91cf\u4e2d (\u6ce8\u610f script: \u524d\u7f00)\n    $script:listProjectName += $ProjectName\n    # \u811a\u672c\u76ee\u5f55\n    # $ScriptDir = $PSScriptRoot\n    # $ParentDir = $ScriptDir\n    $ParentDir = $hookPath\n\n    $JOB_NAME=$projectName\n\n    # \u4e0d\u8bbe\u7f6e\u5219\u53d6\u7236\u7ea7\u540d\u79f0\u4e3a\u9879\u76ee\u540d\u79f0\n    if ([string]::IsNullOrWhiteSpace($projectName)) {\n        $JOB_NAME=Split-Path $ParentDir -Leaf\n    }\n    Log &quot; url host is :${JENKINS_URL} &quot;\n\n    $uri = &quot;$($JENKINS_URL.TrimEnd('/'))/job/$JOB_NAME/buildWithParameters&quot;\n\n    Log &quot;url: $uri&quot;\n\n    $authPair = &quot;$($username):$($password)&quot;\n    $encodedCredentials = [System.Convert]::ToBase64String([System.Text.Encoding]::ASCII.GetBytes($authPair))\n    $headers = @{\n        Authorization = &quot;Basic $encodedCredentials&quot;\n    }\n\n    Invoke-WebRequest -UseBasicParsing `\n    -Uri $uri `\n    -Method Post `\n    -Headers $headers `\n    -Body @{\n        REVISION=&quot;HEAD&quot;\n    }\n}\nfunction CheckChildUpdate {\n    # ---------------------- \u914d\u7f6e\u533a\u57df ----------------------\n    param(\n        [string]$Revision = &quot;413&quot;,\n        [string]$WatchDir = &quot;/&quot;\n    )\n\n    # ---------------------- 1. \u83b7\u53d6 SVN \u65e5\u5fd7 ----------------------\n    Log &quot;\u6b63\u5728\u67e5\u8be2 SVN \u7248\u672c: $Revision ...&quot;\n    Log &quot;WatchDir is: $WatchDir&quot;\n\n    # \u4f7f\u7528 --xml \u53c2\u6570\uff0c\u8fd9\u6837 PowerShell \u53ef\u4ee5\u76f4\u63a5\u8f6c\u6362\u6210\u5bf9\u8c61\uff0c\u4e0d\u7528\u53bb\u622a\u53d6\u5b57\u7b26\u4e32\n    # \u8fd9\u91cc\u7684 2&gt;&amp;1 \u662f\u4e3a\u4e86\u6355\u83b7\u53ef\u80fd\u7684\u9519\u8bef\n    try {\n        # \u6ce8\u610f\uff1a\u5982\u679c\u662f\u79c1\u6709\u4ed3\u5e93\uff0c\u53ef\u80fd\u9700\u8981\u8ffd\u52a0 --username &quot;xxx&quot; --password &quot;xxx&quot;\n        [xml]$svnLog = svn log . -r $Revision -v --xml\n    }\n    catch {\n        Log &quot;SVN \u547d\u4ee4\u6267\u884c\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5 SVN \u547d\u4ee4\u884c\u5de5\u5177\u662f\u5426\u5b89\u88c5\uff0c\u6216 URL/\u6743\u9650\u662f\u5426\u6b63\u786e\u3002&quot;\n        # Read-Host &quot;Press Enter to exit&quot;\n        exit 1\n    }\n    Log &quot;get svn log done.&quot;\n\n    # ---------------------- 2. \u63d0\u53d6\u53d8\u66f4\u6587\u4ef6\u5217\u8868 ----------------------\n    # \u5bb9\u9519\u5904\u7406\uff1a\u786e\u4fdd XML \u7ed3\u6784\u5b58\u5728\n    if ($null -eq $svnLog.log.logentry) {\n        Log &quot;\u672a\u627e\u5230\u7248\u672c\u4fe1\u606f (\u53ef\u80fd\u7248\u672c\u53f7\u4e0d\u5b58\u5728)&quot;\n        exit\n    }\n\n    # \u83b7\u53d6\u6240\u6709\u53d8\u66f4\u8def\u5f84\u7684\u8282\u70b9\n    # .InnerText \u4f1a\u83b7\u53d6\u5f62\u5982 &quot;/trunk/ProjectA/code.cs&quot; \u7684\u5b57\u7b26\u4e32\n    $changedPaths = $svnLog.log.logentry.paths.path | ForEach-Object { $_.InnerText }\n\n    Log &quot;\u8be5\u7248\u672c\u53d8\u66f4\u4e86 $($changedPaths.Count) \u4e2a\u6587\u4ef6\u3002&quot;\n\n    # ---------------------- 3. \u5339\u914d\u903b\u8f91\u4e0e\u6267\u884c ----------------------\n\n    # \u5b9a\u4e49\u4e00\u4e2a\u6807\u5fd7\u4f4d\n    $isHit = $false\n\n    # \u904d\u5386\u6240\u6709\u53d8\u66f4\u6587\u4ef6\n    foreach ($pathTemp in $changedPaths) {\n    \n        # Write-Host &quot;\u53d8\u66f4\u6587\u4ef6: $path&quot;\n        Log &quot;pathTemp  is: $pathTemp&quot;\n\n        $targetPath=Join-Path (Split-Path $Path  -Parent) $pathTemp\n        Log &quot;targetpath: $targetPath&quot;\n\n        if ($targetPath -like &quot;$WatchDir*&quot;) {\n            Log &quot; fiind target path: $pathTemp&quot;\n            $isHit = $true\n            break \n        }\n    }\n    return $isHit\n}\nfunction BuildWithCommand {\n    # ---------------------- \u914d\u7f6e\u533a\u57df ----------------------\n    param(\n        [string]$Revision = &quot;413&quot;,\n        [string]$WatchDir = &quot;/&quot;\n    )\n\n    # ---------------------- 1. \u83b7\u53d6 SVN \u65e5\u5fd7 ----------------------\n    Log &quot;for BuildWithCommand search svn version: $Revision ...&quot;\n    Log &quot;WatchDir is: $WatchDir&quot;\n\n    # \u4f7f\u7528 --xml \u53c2\u6570\uff0c\u8fd9\u6837 PowerShell \u53ef\u4ee5\u76f4\u63a5\u8f6c\u6362\u6210\u5bf9\u8c61\uff0c\u4e0d\u7528\u53bb\u622a\u53d6\u5b57\u7b26\u4e32\n    # \u8fd9\u91cc\u7684 2&gt;&amp;1 \u662f\u4e3a\u4e86\u6355\u83b7\u53ef\u80fd\u7684\u9519\u8bef\n    try {\n        # \u6ce8\u610f\uff1a\u5982\u679c\u662f\u79c1\u6709\u4ed3\u5e93\uff0c\u53ef\u80fd\u9700\u8981\u8ffd\u52a0 --username &quot;xxx&quot; --password &quot;xxx&quot;\n        [xml]$svnLog = svn log . -r $Revision -v --xml\n    }\n    catch {\n        Log &quot;SVN \u547d\u4ee4\u6267\u884c\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5 SVN \u547d\u4ee4\u884c\u5de5\u5177\u662f\u5426\u5b89\u88c5\uff0c\u6216 URL/\u6743\u9650\u662f\u5426\u6b63\u786e\u3002&quot;\n        # Read-Host &quot;Press Enter to exit&quot;\n        exit 1\n    }\n    Log &quot;get svn log done.&quot;\n\n    # ---------------------- 2. \u63d0\u53d6\u53d8\u66f4\u6587\u4ef6\u5217\u8868 ----------------------\n    # \u5bb9\u9519\u5904\u7406\uff1a\u786e\u4fdd XML \u7ed3\u6784\u5b58\u5728\n    if ($null -eq $svnLog.log.logentry) {\n        Log &quot;\u672a\u627e\u5230\u7248\u672c\u4fe1\u606f (\u53ef\u80fd\u7248\u672c\u53f7\u4e0d\u5b58\u5728)&quot;\n        exit\n    }\n\n    $commitMsg = $svnLog.log.logentry.msg.ToString()\n\n    Log &quot;Commit Message: $commitMsg&quot;\n\n    # ---------------------- 3. \u5339\u914d\u903b\u8f91\u4e0e\u6267\u884c ----------------------\n\n    # \u5b9a\u4e49\u4e00\u4e2a\u6807\u5fd7\u4f4d\n    $isHit = $false\n\n    # ----------------------------------------------------\n    # \u89c4\u5219 A: \u68c0\u67e5\u662f\u5426\u8df3\u8fc7 CI\n    # \u4f7f\u7528\u6b63\u5219\u5339\u914d\uff0c(?i) \u8868\u793a\u4e0d\u533a\u5206\u5927\u5c0f\u5199\n    # ----------------------------------------------------\n    if ($commitMsg -match &quot;(?i)\\[(ci skip|skip ci|no build)\\]&quot;) {\n        Log &quot;\u68c0\u6d4b\u5230\u8df3\u8fc7\u6307\u4ee4 [ci skip]\uff0c\u505c\u6b62\u6267\u884c CI \u6d41\u7a0b\u3002&quot;\n        exit 0 # \u6b63\u5e38\u9000\u51fa\uff0c\u4e0d\u62a5\u9519\n    }\n\n    # ----------------------------------------------------\n    # \u89c4\u5219 B: \u68c0\u67e5\u662f\u5426\u5f3a\u5236\u6784\u5efa\u7279\u5b9a\u9879\u76ee (\u9488\u5bf9\u4f60\u7684 LifeHelper)\n    # ----------------------------------------------------\n    if ($commitMsg -match &quot;(?i)\\[build:\\s*web\\]&quot;) {\n        Log &quot;\u68c0\u6d4b\u5230 [build: web] \u6307\u4ee4\uff0c\u5f3a\u5236\u89e6\u53d1 Web \u6784\u5efa...&quot;\n        # \u8c03\u7528 Web \u7684\u6784\u5efa\u51fd\u6570\n        # Invoke-JenkinsJob &quot;LifeHelper.Web&quot;\n    }\n\n    $pattern = &quot;build\\s*:\\s*([\\w\\.-]+)&quot;\n\n    if ($commitMsg -match $pattern) {\n        # $matches[0] \u662f\u5339\u914d\u5230\u7684\u5b8c\u6574\u5b57\u7b26\u4e32 (\u4f8b\u5982 &quot;build: LifeHelper.Web&quot;)\n        # $matches[1] \u662f\u62ec\u53f7\u91cc\u6355\u83b7\u7684\u5185\u5bb9 (\u5373\u6211\u4eec\u8981\u7684 &quot;LifeHelper.Web&quot;)\n        \n        $serviceName = $matches[1]\n        \n        Log &quot;match build server: [$serviceName]&quot;\n    \n        # \u8fd9\u91cc\u53ef\u4ee5\u6839\u636e\u63d0\u53d6\u5230\u7684\u540d\u79f0\u53bb\u6267\u884c\u903b\u8f91\n        if ($serviceName -eq &quot;LifeHelper.Web&quot;) {\n            # \u89e6\u53d1 Web \u6784\u5efa\n        }\n        BuildProject $serviceName\n        exit 0 # \u6b63\u5e38\u9000\u51fa\uff0c\u4e0d\u62a5\u9519\n    }\n\n    return $isHit\n}\n# ([system.environment]::GetCommandLineArgs()|ForEach-Object -process { '\\&quot;{0}\\&quot;' -f $_ })\n$myArgs = [System.Environment]::GetCommandLineArgs()\n\n$target = $RESULTPATH\n\nfor ($i = 0; $i -lt $myArgs.Length; $i++) {\n    Log (&quot;arg[{0}] = `&quot;{1}`&quot;&quot; -f $i, $myArgs[$i])\n    # if($i -eq 7){\n    #     $target=$myArgs[$i];\n    # }\n}\nLog &quot;target is: $target&quot;\n$PATH=$myArgs[1]\nLog &quot;new PATH: $PATH&quot;\n\nif (![string]::IsNullOrWhiteSpace($projectName)) {\n       BuildProject $projectName\n}\n\nBuildWithCommand -Revision $REVISION -WatchDir $target\n\n$fullPathMap = [System.Collections.Generic.List[PSCustomObject]]::new()\n\nforeach ($kv in $pathMap) {\n    $key=$kv.Path;\n     Log &quot;key is $key &quot;\n    $fullPath = Join-Path $svnPath $key\n    Log &quot;full path ${fullPath}&quot;\n    Log &quot;kv is $kv &quot;\n    # Log &quot;kvvalue is $(pathMap[$key])&quot;\n    $obj = [PSCustomObject]@{\n        Path = $fullPath\n        JobName     = $kv.JobName\n    }\n    $fullPathMap.Add($obj);\n    # $fullPathMap.Add($fullPath,$(pathMap[$key]))\n}\n\n\nLog &quot;target is: $targetNorm&quot;\n\n# \u89c4\u8303\u5316\u8def\u5f84\uff08\u975e\u5e38\u91cd\u8981\uff09\n# $targetNorm = [System.IO.Path]::GetFullPath($target).TrimEnd('\\')\n$targetNorm = $target\nLog &quot;targetNorm is: $targetNorm&quot;\n# \u5339\u914d\u5e76\u53d6 Value\uff08\u6838\u5fc3\u903b\u8f91\uff09\n$matchedValue = $null\n\nforeach ($entry in $fullPathMap) {\n    $keyNorm = [System.IO.Path]::GetFullPath($entry.Path).TrimEnd('\\')\n    Log &quot;keyNorm is: $keyNorm&quot;\n \n    if ($targetNorm.StartsWith($keyNorm, [System.StringComparison]::OrdinalIgnoreCase)) {\n        $matchedValue = $entry.JobName\n        Log &quot;Matched path: $keyNorm =&gt; value: $matchedValue&quot;\n        BuildProject  $matchedValue $keyNorm\n    }\n    else {\n        Log &quot;Not matched path: $keyNorm try find by parent&quot;\n        if($keyNorm.StartsWith($targetNorm, [System.StringComparison]::OrdinalIgnoreCase)){\n            $isHit = CheckChildUpdate -Revision $REVISION -WatchDir $keyNorm\n            if($isHit){\n                $matchedValue = $entry.JobName\n                Log &quot;Matched by child path: $keyNorm =&gt; value: $matchedValue&quot;\n                BuildProject  $matchedValue $keyNorm\n            }\n        }\n    }\n}\n\nif ($null -eq $matchedValue) {\n    Log &quot;No path matched: $targetNorm&quot;\n    # Read-Host &quot;Press Enter to exit&quot;\n    return\n}\n\nWrite-Host &quot;$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss.fff') script end&quot;\nAdd-Content svn-hook.log &quot;$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss.fff') commit done&quot;\n# Read-Host &quot;Press Enter to exit&quot;\n</code></pre>\n<p>Also ,you can run fllow command .</p>\n<pre class=\"lang-bash prettyprint-override\"><code>.\\autoJenkins.ps1 -REVISION &quot;500&quot; -RESULTPATH &quot;G:\\work\\SVN\\LifeHelper\\Program\\InterFace\\WebService&quot;\n\n.\\autoJenkins.ps1 -projectName &quot;Jobname&quot;\n\n\n</code></pre>\n<p>and you can build a project with SVN commit<code>svn commit -m &quot;update: manual trigger [build: MySpecialJob]&quot;</code></p>\n", "tags": ["svn", "post", "hook", "commit"]}
