name: Hourly RAG Update

on:
  schedule:
    - cron: "10 * * * *"  # every hour at minute 10
  workflow_dispatch:

jobs:
  update-rag:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install sentence-transformers faiss-cpu pandas huggingface_hub

      - name: Download latest train.jsonl from HuggingFace
        run: |
          wget -q -O train.jsonl "https://huggingface.co/datasets/Sachin21112004/DreamFlow-AI-Data/resolve/main/train.jsonl"
        # if your repo is private you can use curl with HF_TOKEN, see notes below

      - name: Run RAG update script (build embeddings)
        run: |
          python rag_update.py

      - name: Upload new RAG index to HuggingFace
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python upload_to_hf.py
