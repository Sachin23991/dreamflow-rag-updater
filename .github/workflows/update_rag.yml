name: Daily RAG Update

on:
  schedule:
    - cron: "40 23 * * *"   # daily at 23:40 UTC
  workflow_dispatch:

jobs:
  update-rag:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install sentence-transformers faiss-cpu pandas huggingface_hub

      - name: Download latest train.jsonl
        run: |
          wget -O train.jsonl "https://huggingface.co/datasets/Sachin21112004/DreamFlow-AI-Data/resolve/main/train.jsonl"

      - name: Run RAG update script
        run: |
          python rag_update.py

      - name: Upload RAG to HuggingFace model repo
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python upload_to_hf.py
