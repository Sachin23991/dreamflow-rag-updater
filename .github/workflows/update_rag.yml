name: Hourly RAG Update Pipeline

on:
  schedule:
    - cron: "0 * * * *"   # Runs every hour
  workflow_dispatch:     # Allows manual trigger

jobs:
  rag-update:
    runs-on: ubuntu-latest

    steps:
      # ✅ Step 1: Checkout GitHub Repo
      - name: Checkout Repository
        uses: actions/checkout@v4

      # ✅ Step 2: Setup Python
      - name: Setup Python Environment
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      # ✅ Step 3: Install Dependencies
      - name: Install Python Dependencies
        run: |
          pip install --upgrade pip
          pip install requests huggingface_hub

      # ✅ Step 4: Set Hugging Face Token (Secret)
      - name: Set Hugging Face Auth
        run: |
          echo "HF_TOKEN=${{ secrets.HF_TOKEN }}" >> $GITHUB_ENV

      # ✅ Step 5: Run Your Complete Pipeline
      - name: Run RAG Update Pipeline
        env:
          HUGGINGFACE_HUB_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python main.py

      # ✅ Step 6: Commit & Push for GitHub Contributions
      - name: Auto Commit & Push
        run: |
          git config --global user.name "Sachin23991"
          git config --global user.email "sachinraosahab7@gmail.com"
          git add .
          git commit -m "Hourly RAG Update - $(date -u)"
          git push || echo "No changes to commit"
